
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionari AVIS</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#128221;</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#128221;</text></svg>">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: #f0f2f5;
            margin: 0; padding: 0;
            color: #333;
        }
        
        .container {
            max-width: 600px; 
            margin: 10px auto;
            background: #fff; 
            min-height: 90vh;
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex; flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .container { max-width: 98%; margin: 5px auto; } 
            .q-details-content {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                border-top: 1px solid #ccc;
                border-left: 1px solid #ccc;
            }
            .qa-row {
                border-bottom: 1px solid #ccc;
                border-right: 1px solid #ccc;
                padding: 4px 8px;
                background: #fff; 
                height: 100%;
                align-items: center;
            }
        }

        @media print {
            .header, .search-area, .modal-overlay { display: none !important; }
            body { background: white; padding: 0; }
            .container { box-shadow: none; border: none; width: 100%; max-width: 100%; margin: 0; }
            .list-viewport { overflow: visible; height: auto; }
            .q-item:not(.open) { display: none; }
            .q-details { display: block !important; padding: 0; }
            .q-details-content { column-count: 2; column-gap: 20px; display: block; }
            .qa-row { break-inside: avoid; border-bottom: 1px solid #ddd; padding: 5px 0; display: flex; justify-content: space-between; }
            .q-item.open::before {
                content: attr(data-print-title);
                display: block; font-size: 16pt; font-weight: bold; margin-bottom: 10px; text-align: center; border-bottom: 2px solid black; padding-bottom: 5px;
            }
        }

        .header {
            background-color: #e30613; color: white; padding: 8px 15px; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: background-color 0.3s ease;
        }
        .header.active-green { background-color: #28a745; }
        .header h1 { margin: 0; font-size: 1.2rem; flex: 1; text-align: center; }
        .header-controls { display: flex; align-items: center; gap: 5px; }
        .header-btn { background: transparent; border: none; color: white; font-size: 24px; font-weight: bold; cursor: pointer; padding: 0 8px; }
        .print-btn, .home-btn { background: transparent; border: none; font-size: 24px; cursor: pointer; padding: 0 8px; display: none; color: white; }

        .search-area { padding: 10px 15px; background: #fafafa; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; transition: 0.3s; overflow: hidden; }
        .search-area.hidden { max-height: 0; opacity: 0; padding: 0 15px; border-bottom: none; }
        .search-wrapper { position: relative; flex: 1; }
        .search-box { width: 100%; padding: 8px 35px 8px 15px; font-size: 16px; border: 1px solid #ccc; border-radius: 20px; outline: none; }
        .clear-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #999; cursor: pointer; font-weight: bold; font-size: 18px; display: none; }
        .results-count { color: #e30613; font-weight: bold; font-size: 0.95rem; }

        .list-viewport { flex: 1; overflow-y: auto; padding: 10px; }
        .q-item { margin-bottom: 8px; border-radius: 6px; border: 1px solid #c3e6cb; background: white; }
        .q-header { padding: 10px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; background-color: #d4edda; color: #155724; }
        .opt-badge { font-size: 0.85rem; padding: 2px 10px; border-radius: 15px; margin-left: 10px; background: #fff; border: 1px solid #28a745; color: #28a745; font-weight: bold; }
        
        .q-item.open { border: none; margin: 0; height: 100%; }
        .q-item.open .q-header { display: none; }
        .q-details { display: block; padding: 5px; background: #fff; }
        .qa-row { display: flex; justify-content: space-between; border-bottom: 1px dotted #e0e0e0; padding: 6px 4px; cursor: pointer; }
        .qa-row:hover { background-color: #f0f0f0; } 
        .question { color: #555; font-size: 0.90rem; flex: 1; }
        .answer { font-weight: bold; color: #000; font-size: 0.90rem; text-align: right; max-width: 50%; }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; width: 90%; max-width: 500px; display: flex; flex-direction: column; max-height: 85vh; }
        .modal-body { overflow-y: auto; flex: 1; margin-bottom: 15px; }
        .modal-question { font-weight: bold; margin-bottom: 10px; color: #000; font-size: 1.1em; background: #e3f2fd; padding: 12px; border-radius: 6px; border-bottom: 2px solid #90caf9; }
        .modal-option { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .modal-option.selected { background: #d4edda; color: #155724; font-weight: bold; border-left: 5px solid #28a745; }
        .perc-badge { background: #eee; padding: 2px 6px; border-radius: 10px; font-size: 0.85em; }
        .modal-footer { display: flex; justify-content: center; gap: 20px; border-top: 1px solid #eee; padding-top: 10px; }
        .close-modal { padding: 10px 25px; background: #d0d0d0; border: none; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .btn-round-nav { width: 40px; height: 40px; border-radius: 50%; background: #d0d0d0; border: none; cursor: pointer; font-weight: bold; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<div class="container">
    <div id="mainHeader" class="header">
        <div class="header-controls">
            <button class="header-btn" onclick="navigate(-1)">&#8592;</button>
            <button id="homeBtn" class="home-btn" onclick="goHome()">&#127968;</button>
        </div>
        <h1 id="mainTitle">Questionari AVIS</h1>
        <div class="header-controls">
            <button id="printBtn" class="print-btn" onclick="window.print()">&#128424;</button>
            <button class="header-btn" onclick="navigate(1)">&#8594;</button>
        </div>
    </div>

    <div id="searchArea" class="search-area">
        <div class="search-wrapper">
            <input type="text" id="searchInput" class="search-box" placeholder="Cerca nome..." onkeyup="filterList()">
            <span id="clearSearch" class="clear-btn" onclick="clearSearch()">&#10005;</span>
        </div>
        <span id="resultsCount" class="results-count"></span>
    </div>
    
    <div class="list-viewport" id="swipeArea">
        <ul id="qList" class="questionnaire-list"></ul>
    </div>
</div>

<div id="modalOverlay" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-body">
            <div id="modalTitle" class="modal-question"></div>
            <ul id="modalList" class="modal-options"></ul>
        </div>
        <div class="modal-footer">
            <button class="btn-round-nav" onclick="navModalQuestion(-1)">&#8592;</button>
            <button class="close-modal" onclick="closeModal()">Chiudi</button>
            <button class="btn-round-nav" onclick="navModalQuestion(1)">&#8594;</button>
        </div>
    </div>
</div>

<script>
    const allData = [{"id": "CA-GINEVRA", "sex_label": "(Femmina)", "opt_perc": "93% ü§©", "answers": [{"key": "Q1", "q": "1. Hai mai sentito parlare di sistema trasfusionale?", "a_html": "No", "raw_val": "N"}, {"key": "Q2", "q": "2. Hai mai sentito parlare dei gruppi sanguigni?", "a_html": "No", "raw_val": "N"}, {"key": "Q3", "q": "3. Sai che gruppo sanguigno hai tu?", "a_html": "No", "raw_val": "N"}, {"key": "Q4", "q": "4. Cosa pensi significhi 'donazione di sangue'?", "a_html": "Dare il proprio sangue a una persona che ne ha bisogno", "raw_val": "B"}, {"key": "Q5", "q": "5. Cosa pensi significhi 'trasfusione di sangue'?", "a_html": "Trasferire del sangue in una persona", "raw_val": "T"}, {"key": "Q6", "q": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q7", "q": "7. Conosci qualcuno che ha donato Sangue?", "a_html": "Nessuno", "raw_val": "N"}, {"key": "Q8", "q": "8. Conosci qualcuno che ha donato Plasma?", "a_html": "Non so cos‚Äô√® il plasma", "raw_val": "Q"}, {"key": "Q9", "q": "9. Secondo te quanto √® importante donare sangue?", "a_html": "√à molto importante", "raw_val": "S"}, {"key": "Q10", "q": "10. Che cosa pensi della donazione di sangue?", "a_html": "√à una cosa bella", "raw_val": "B"}, {"key": "Q11", "q": "11. Quando pensi alla donazione di sangue, come ti senti?", "a_html": "Felice", "raw_val": "F"}, {"key": "Q12", "q": "12. Quando pensi a qualcuno che dona, come ti senti?", "a_html": "Felice", "raw_val": "F"}, {"key": "Q13", "q": "13. Immaginando te da grande, cosa faresti?", "a_html": "Vorrei donare il sangue", "raw_val": "S"}, {"key": "Q14", "q": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q15", "q": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "a_html": "Almeno una volta a settimana", "raw_val": "S"}, {"key": "Q16", "q": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "a_html": "Tutti i giorni", "raw_val": "T"}, {"key": "Q17", "q": "17. Giochi pi√π spesso a:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q18", "q": "18. Preferisci:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q19", "q": "19. Preferisci giochi in cui:", "a_html": "Devi scoprire cose, Devi risolvere enigmi", "raw_val": "CE"}, {"key": "Q20_1", "q": "20. Gioco preferito 1", "a_html": "JUST DANCE", "raw_val": "JUST DANCE"}, {"key": "Q20_2", "q": "20. Gioco preferito 2", "a_html": "MARIO KART", "raw_val": "MARIO KART"}, {"key": "Q20_3", "q": "20. Gioco preferito 3", "a_html": "ANIMAL CROSSING", "raw_val": "ANIMAL CROSSING"}, {"key": "Q21", "q": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "a_html": "Globulo bianco", "raw_val": "B"}, {"key": "Q22", "q": "22. Quali sono i gruppi sanguigni?", "a_html": "Plasma, sangue e globuli rossi", "raw_val": "P"}, {"key": "Q23", "q": "23. Chi tra queste persone pu√≤ donare sangue?", "a_html": "Giovanna di 45 anni", "raw_val": "G"}, {"key": "Q24", "q": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "a_html": "AB", "raw_val": "A"}, {"key": "Q25", "q": "25. Cosa √® AVIS?", "a_html": "Associazione Volontari Italiani Sangue", "raw_val": "S"}, {"key": "Q26", "q": "26. Chi sono i donatori di sangue?", "a_html": "Persone comuni che vogliono dare il proprio sangue volontariamente", "raw_val": "C"}, {"key": "Q27", "q": "27. Quando √® utilizzato il sangue donato?", "a_html": "In caso di emergenza, operazioni chirurgiche, nella cura di malattie di sangue e in altre terapie", "raw_val": "T"}, {"key": "Q28", "q": "28. In questi ultimi giorni, quanto sei felice?", "a_html": "üòÑ Molto felice", "raw_val": "D"}, {"key": "Q29", "q": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "a_html": "üôÇ Abbastanza soddisfatta/o", "raw_val": "C"}, {"key": "Q30", "q": "30. Quanto sei contenta/o della tua vita a casa?", "a_html": "üòÑ Molto contenta/o", "raw_val": "D"}, {"key": "Q31", "q": "31. Biglietti regalo (0-10)", "a_html": "10", "raw_val": "10"}]}, {"id": "GI-MATTEO", "sex_label": "(Maschio)", "opt_perc": "79% üòä", "answers": [{"key": "Q1", "q": "1. Hai mai sentito parlare di sistema trasfusionale?", "a_html": "No", "raw_val": "N"}, {"key": "Q2", "q": "2. Hai mai sentito parlare dei gruppi sanguigni?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q3", "q": "3. Sai che gruppo sanguigno hai tu?", "a_html": "No", "raw_val": "N"}, {"key": "Q4", "q": "4. Cosa pensi significhi 'donazione di sangue'?", "a_html": "Dare il proprio sangue a una persona che ne ha bisogno", "raw_val": "B"}, {"key": "Q5", "q": "5. Cosa pensi significhi 'trasfusione di sangue'?", "a_html": "Non ne sono sicuro/a", "raw_val": "Q"}, {"key": "Q6", "q": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "a_html": "No", "raw_val": "N"}, {"key": "Q7", "q": "7. Conosci qualcuno che ha donato Sangue?", "a_html": "Nessuno", "raw_val": "N"}, {"key": "Q8", "q": "8. Conosci qualcuno che ha donato Plasma?", "a_html": "Non so cos‚Äô√® il plasma", "raw_val": "Q"}, {"key": "Q9", "q": "9. Secondo te quanto √® importante donare sangue?", "a_html": "√à molto importante", "raw_val": "S"}, {"key": "Q10", "q": "10. Che cosa pensi della donazione di sangue?", "a_html": "√à una cosa bella", "raw_val": "B"}, {"key": "Q11", "q": "11. Quando pensi alla donazione di sangue, come ti senti?", "a_html": "Felice", "raw_val": "F"}, {"key": "Q12", "q": "12. Quando pensi a qualcuno che dona, come ti senti?", "a_html": "Felice", "raw_val": "F"}, {"key": "Q13", "q": "13. Immaginando te da grande, cosa faresti?", "a_html": "Vorrei donare il sangue", "raw_val": "S"}, {"key": "Q14", "q": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "a_html": "Non ne sono sicuro/a", "raw_val": "Q"}, {"key": "Q15", "q": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "a_html": "Tutti i giorni", "raw_val": "T"}, {"key": "Q16", "q": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "a_html": "Tutti i giorni", "raw_val": "T"}, {"key": "Q17", "q": "17. Giochi pi√π spesso a:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q18", "q": "18. Preferisci:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q19", "q": "19. Preferisci giochi in cui:", "a_html": "Devi sconfiggere gli altri", "raw_val": "X"}, {"key": "Q20_1", "q": "20. Gioco preferito 1", "a_html": "UNO", "raw_val": "UNO"}, {"key": "Q20_2", "q": "20. Gioco preferito 2", "a_html": "MONOPOLY", "raw_val": "MONOPOLY"}, {"key": "Q20_3", "q": "20. Gioco preferito 3", "a_html": "ROBLOX", "raw_val": "ROBLOX"}, {"key": "Q21", "q": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "a_html": "Plasma", "raw_val": "M"}, {"key": "Q22", "q": "22. Quali sono i gruppi sanguigni?", "a_html": "A, B, C, D", "raw_val": "D"}, {"key": "Q23", "q": "23. Chi tra queste persone pu√≤ donare sangue?", "a_html": "Simone di 16 anni", "raw_val": "S"}, {"key": "Q24", "q": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "a_html": "AB", "raw_val": "A"}, {"key": "Q25", "q": "25. Cosa √® AVIS?", "a_html": "Associazione Vaccinati Italiani Sanitari", "raw_val": "A"}, {"key": "Q26", "q": "26. Chi sono i donatori di sangue?", "a_html": "Persone comuni che vogliono dare il proprio sangue volontariamente", "raw_val": "C"}, {"key": "Q27", "q": "27. Quando √® utilizzato il sangue donato?", "a_html": "Solo in caso di emergenze al pronto soccorso", "raw_val": "E"}, {"key": "Q28", "q": "28. In questi ultimi giorni, quanto sei felice?", "a_html": "üôÇ Abbastanza felice", "raw_val": "C"}, {"key": "Q29", "q": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "a_html": "üôÇ Abbastanza soddisfatta/o", "raw_val": "C"}, {"key": "Q30", "q": "30. Quanto sei contenta/o della tua vita a casa?", "a_html": "üòÑ Molto contenta/o", "raw_val": "D"}, {"key": "Q31", "q": "31. Biglietti regalo (0-10)", "a_html": "10", "raw_val": "10"}]}, {"id": "MO-CHIARA", "sex_label": "(Femmina)", "opt_perc": "79% üòä", "answers": [{"key": "Q1", "q": "1. Hai mai sentito parlare di sistema trasfusionale?", "a_html": "No", "raw_val": "N"}, {"key": "Q2", "q": "2. Hai mai sentito parlare dei gruppi sanguigni?", "a_html": "No", "raw_val": "N"}, {"key": "Q3", "q": "3. Sai che gruppo sanguigno hai tu?", "a_html": "No", "raw_val": "N"}, {"key": "Q4", "q": "4. Cosa pensi significhi 'donazione di sangue'?", "a_html": "Dare il proprio sangue a una persona che ne ha bisogno", "raw_val": "B"}, {"key": "Q5", "q": "5. Cosa pensi significhi 'trasfusione di sangue'?", "a_html": "Trasferire del sangue in una persona", "raw_val": "T"}, {"key": "Q6", "q": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q7", "q": "7. Conosci qualcuno che ha donato Sangue?", "a_html": "S√¨, una sola persona", "raw_val": "U"}, {"key": "Q8", "q": "8. Conosci qualcuno che ha donato Plasma?", "a_html": "Non so cos‚Äô√® il plasma", "raw_val": "Q"}, {"key": "Q9", "q": "9. Secondo te quanto √® importante donare sangue?", "a_html": "√à molto importante", "raw_val": "S"}, {"key": "Q10", "q": "10. Che cosa pensi della donazione di sangue?", "a_html": "√à una cosa bella", "raw_val": "B"}, {"key": "Q11", "q": "11. Quando pensi alla donazione di sangue, come ti senti?", "a_html": "Felice", "raw_val": "F"}, {"key": "Q12", "q": "12. Quando pensi a qualcuno che dona, come ti senti?", "a_html": "Felice", "raw_val": "F"}, {"key": "Q13", "q": "13. Immaginando te da grande, cosa faresti?", "a_html": "Vorrei donare il sangue", "raw_val": "S"}, {"key": "Q14", "q": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "a_html": "Non ne sono sicuro/a", "raw_val": "Q"}, {"key": "Q15", "q": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "a_html": "Quasi mai", "raw_val": "Q"}, {"key": "Q16", "q": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "a_html": "Almeno una volta a settimana", "raw_val": "S"}, {"key": "Q17", "q": "17. Giochi pi√π spesso a:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q18", "q": "18. Preferisci:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q19", "q": "19. Preferisci giochi in cui:", "a_html": "Devi scoprire cose", "raw_val": "C"}, {"key": "Q20_1", "q": "20. Gioco preferito 1", "a_html": "AVATAR DARTGRD", "raw_val": "AVATAR DARTGRD"}, {"key": "Q20_2", "q": "20. Gioco preferito 2", "a_html": "JUST DANCE", "raw_val": "JUST DANCE"}, {"key": "Q20_3", "q": "20. Gioco preferito 3", "a_html": "WARIO WARE", "raw_val": "WARIO WARE"}, {"key": "Q21", "q": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "a_html": "Piastrina", "raw_val": "P"}, {"key": "Q22", "q": "22. Quali sono i gruppi sanguigni?", "a_html": "Plasma, sangue e globuli rossi", "raw_val": "P"}, {"key": "Q23", "q": "23. Chi tra queste persone pu√≤ donare sangue?", "a_html": "Giovanna di 45 anni", "raw_val": "G"}, {"key": "Q24", "q": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "a_html": "AB", "raw_val": "A"}, {"key": "Q25", "q": "25. Cosa √® AVIS?", "a_html": "Associazione Vaccinati Italiani Sanitari", "raw_val": "A"}, {"key": "Q26", "q": "26. Chi sono i donatori di sangue?", "a_html": "Persone comuni che vogliono dare il proprio sangue volontariamente", "raw_val": "C"}, {"key": "Q27", "q": "27. Quando √® utilizzato il sangue donato?", "a_html": "Solo se sono presenti delle malattie del sangue", "raw_val": "M"}, {"key": "Q28", "q": "28. In questi ultimi giorni, quanto sei felice?", "a_html": "üòÑ Molto felice", "raw_val": "D"}, {"key": "Q29", "q": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "a_html": "üôÇ Abbastanza soddisfatta/o", "raw_val": "C"}, {"key": "Q30", "q": "30. Quanto sei contenta/o della tua vita a casa?", "a_html": "üôÇ Abbastanza contenta/o", "raw_val": "C"}, {"key": "Q31", "q": "31. Biglietti regalo (0-10)", "a_html": "S√¨", "raw_val": "S√¨"}]}, {"id": "NO-GIULIO", "sex_label": "(Maschio)", "opt_perc": "79% üòä", "answers": [{"key": "Q1", "q": "1. Hai mai sentito parlare di sistema trasfusionale?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q2", "q": "2. Hai mai sentito parlare dei gruppi sanguigni?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q3", "q": "3. Sai che gruppo sanguigno hai tu?", "a_html": "No", "raw_val": "N"}, {"key": "Q4", "q": "4. Cosa pensi significhi 'donazione di sangue'?", "a_html": "Dare il proprio sangue a una persona che ne ha bisogno", "raw_val": "B"}, {"key": "Q5", "q": "5. Cosa pensi significhi 'trasfusione di sangue'?", "a_html": "Non ne sono sicuro/a", "raw_val": "Q"}, {"key": "Q6", "q": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q7", "q": "7. Conosci qualcuno che ha donato Sangue?", "a_html": "S√¨, pi√π di una persona", "raw_val": "P"}, {"key": "Q8", "q": "8. Conosci qualcuno che ha donato Plasma?", "a_html": "No", "raw_val": "N"}, {"key": "Q9", "q": "9. Secondo te quanto √® importante donare sangue?", "a_html": "Non √® importante", "raw_val": "N"}, {"key": "Q10", "q": "10. Che cosa pensi della donazione di sangue?", "a_html": "√à una cosa bella", "raw_val": "B"}, {"key": "Q11", "q": "11. Quando pensi alla donazione di sangue, come ti senti?", "a_html": "Non lo so", "raw_val": "N"}, {"key": "Q12", "q": "12. Quando pensi a qualcuno che dona, come ti senti?", "a_html": "Felice", "raw_val": "F"}, {"key": "Q13", "q": "13. Immaginando te da grande, cosa faresti?", "a_html": "Non vorrei donare il sangue", "raw_val": "N"}, {"key": "Q14", "q": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "a_html": "S√¨", "raw_val": "S"}, {"key": "Q15", "q": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "a_html": "Tutti i giorni", "raw_val": "T"}, {"key": "Q16", "q": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "a_html": "Tutti i giorni", "raw_val": "T"}, {"key": "Q17", "q": "17. Giochi pi√π spesso a:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q18", "q": "18. Preferisci:", "a_html": "Giochi in cui devi muoverti", "raw_val": "M"}, {"key": "Q19", "q": "19. Preferisci giochi in cui:", "a_html": "Devi collezionare premi", "raw_val": "P"}, {"key": "Q20_1", "q": "20. Gioco preferito 1", "a_html": "FIFA", "raw_val": "FIFA"}, {"key": "Q20_2", "q": "20. Gioco preferito 2", "a_html": "GIOCO DELL'OCA", "raw_val": "GIOCO DELL'OCA"}, {"key": "Q20_3", "q": "20. Gioco preferito 3", "a_html": "FORZA 4", "raw_val": "FORZA 4"}, {"key": "Q21", "q": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "a_html": "Globulo rosso", "raw_val": "R"}, {"key": "Q22", "q": "22. Quali sono i gruppi sanguigni?", "a_html": "A, B, C, D", "raw_val": "D"}, {"key": "Q23", "q": "23. Chi tra queste persone pu√≤ donare sangue?", "a_html": "Giovanna di 45 anni", "raw_val": "G"}, {"key": "Q24", "q": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "a_html": "XY", "raw_val": "X"}, {"key": "Q25", "q": "25. Cosa √® AVIS?", "a_html": "Associazione Volontari Italiani Sangue", "raw_val": "S"}, {"key": "Q26", "q": "26. Chi sono i donatori di sangue?", "a_html": "Persone comuni che sono pagate per dare il proprio sangue", "raw_val": "D"}, {"key": "Q27", "q": "27. Quando √® utilizzato il sangue donato?", "a_html": "Solo in caso di emergenze al pronto soccorso", "raw_val": "E"}, {"key": "Q28", "q": "28. In questi ultimi giorni, quanto sei felice?", "a_html": "üòÑ Molto felice", "raw_val": "D"}, {"key": "Q29", "q": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "a_html": "üôÇ Abbastanza soddisfatta/o", "raw_val": "C"}, {"key": "Q30", "q": "30. Quanto sei contenta/o della tua vita a casa?", "a_html": "üòÑ Molto contenta/o", "raw_val": "D"}, {"key": "Q31", "q": "31. Biglietti regalo (0-10)", "a_html": "5", "raw_val": "5"}]}, {"id": "PE-GINEVRA", "sex_label": "(Femmina)", "opt_perc": "57% üôÇ", "answers": [{"key": "Q1", "q": "1. Hai mai sentito parlare di sistema trasfusionale?", "a_html": "No", "raw_val": "N"}, {"key": "Q2", "q": "2. Hai mai sentito parlare dei gruppi sanguigni?", "a_html": "No", "raw_val": "N"}, {"key": "Q3", "q": "3. Sai che gruppo sanguigno hai tu?", "a_html": "No", "raw_val": "N"}, {"key": "Q4", "q": "4. Cosa pensi significhi 'donazione di sangue'?", "a_html": "Dare il proprio sangue a una persona che ne ha bisogno", "raw_val": "B"}, {"key": "Q5", "q": "5. Cosa pensi significhi 'trasfusione di sangue'?", "a_html": "Trasferire del sangue in una persona", "raw_val": "T"}, {"key": "Q6", "q": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "a_html": "No", "raw_val": "N"}, {"key": "Q7", "q": "7. Conosci qualcuno che ha donato Sangue?", "a_html": "Nessuno", "raw_val": "N"}, {"key": "Q8", "q": "8. Conosci qualcuno che ha donato Plasma?", "a_html": "No", "raw_val": "N"}, {"key": "Q9", "q": "9. Secondo te quanto √® importante donare sangue?", "a_html": "Non √® importante", "raw_val": "N"}, {"key": "Q10", "q": "10. Che cosa pensi della donazione di sangue?", "a_html": "Non ne sono sicuro/a", "raw_val": "Q"}, {"key": "Q11", "q": "11. Quando pensi alla donazione di sangue, come ti senti?", "a_html": "Non lo so", "raw_val": "N"}, {"key": "Q12", "q": "12. Quando pensi a qualcuno che dona, come ti senti?", "a_html": "Non lo so", "raw_val": "N"}, {"key": "Q13", "q": "13. Immaginando te da grande, cosa faresti?", "a_html": "Non ne sono sicuro/a", "raw_val": "Q"}, {"key": "Q14", "q": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "a_html": "Non ne sono sicuro/a", "raw_val": "Q"}, {"key": "Q15", "q": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "a_html": "Almeno una volta a settimana", "raw_val": "S"}, {"key": "Q16", "q": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "a_html": "Almeno una volta a settimana", "raw_val": "S"}, {"key": "Q17", "q": "17. Giochi pi√π spesso a:", "a_html": "Giochi in cui devi pensare", "raw_val": "P"}, {"key": "Q18", "q": "18. Preferisci:", "a_html": "Giochi in cui devi pensare", "raw_val": "P"}, {"key": "Q19", "q": "19. Preferisci giochi in cui:", "a_html": "Devi risolvere enigmi, Devi scoprire cose, Devi aiutare gli altri", "raw_val": "ECA"}, {"key": "Q20_1", "q": "20. Gioco preferito 1", "a_html": "NASCONDINO", "raw_val": "NASCONDINO"}, {"key": "Q20_2", "q": "20. Gioco preferito 2", "a_html": "ACCHIAPPARELLA", "raw_val": "ACCHIAPPARELLA"}, {"key": "Q20_3", "q": "20. Gioco preferito 3", "a_html": "PALESTRA", "raw_val": "PALESTRA"}, {"key": "Q21", "q": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "a_html": "Plasma", "raw_val": "M"}, {"key": "Q22", "q": "22. Quali sono i gruppi sanguigni?", "a_html": "Plasma, sangue e globuli rossi", "raw_val": "P"}, {"key": "Q23", "q": "23. Chi tra queste persone pu√≤ donare sangue?", "a_html": "Cristiano di 75 anni", "raw_val": "C"}, {"key": "Q24", "q": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "a_html": "XY", "raw_val": "X"}, {"key": "Q25", "q": "25. Cosa √® AVIS?", "a_html": "Associazione Volontari Italiani Sangue", "raw_val": "S"}, {"key": "Q26", "q": "26. Chi sono i donatori di sangue?", "a_html": "Persone comuni che sono pagate per dare il proprio sangue", "raw_val": "D"}, {"key": "Q27", "q": "27. Quando √® utilizzato il sangue donato?", "a_html": "In caso di emergenza, operazioni chirurgiche, nella cura di malattie di sangue e in altre terapie", "raw_val": "T"}, {"key": "Q28", "q": "28. In questi ultimi giorni, quanto sei felice?", "a_html": "üòÑ Molto felice", "raw_val": "D"}, {"key": "Q29", "q": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "a_html": "üôÇ Abbastanza soddisfatta/o", "raw_val": "C"}, {"key": "Q30", "q": "30. Quanto sei contenta/o della tua vita a casa?", "a_html": "üòÑ Molto contenta/o", "raw_val": "D"}, {"key": "Q31", "q": "31. Biglietti regalo (0-10)", "a_html": "6", "raw_val": "6"}]}];
    const decodingMap = {"Sesso": {"text": "Sesso", "options": {"F": "Femmina", "M": "Maschio"}}, "Q1": {"text": "1. Hai mai sentito parlare di sistema trasfusionale?", "options": {"S": "S√¨", "N": "No"}}, "Q2": {"text": "2. Hai mai sentito parlare dei gruppi sanguigni?", "options": {"S": "S√¨", "N": "No"}}, "Q3": {"text": "3. Sai che gruppo sanguigno hai tu?", "options": {"S": "S√¨", "N": "No"}}, "Q4": {"text": "4. Cosa pensi significhi 'donazione di sangue'?", "options": {"B": "Dare il proprio sangue a una persona che ne ha bisogno", "N": "Dare il proprio sangue in cambio di denaro", "Q": "Non ne sono sicuro/a"}}, "Q5": {"text": "5. Cosa pensi significhi 'trasfusione di sangue'?", "options": {"M": "Modificare il sangue di una persona", "T": "Trasferire del sangue in una persona", "Q": "Non ne sono sicuro/a"}}, "Q6": {"text": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "options": {"S": "S√¨", "N": "No"}}, "Q7": {"text": "7. Conosci qualcuno che ha donato Sangue?", "options": {"P": "S√¨, pi√π di una persona", "U": "S√¨, una sola persona", "N": "Nessuno"}}, "Q8": {"text": "8. Conosci qualcuno che ha donato Plasma?", "options": {"S": "S√¨", "N": "No", "Q": "Non so cos‚Äô√® il plasma"}}, "Q9": {"text": "9. Secondo te quanto √® importante donare sangue?", "options": {"S": "√à molto importante", "B": "√à abbastanza importante", "N": "Non √® importante", "Q": "Non √® importante"}}, "Q10": {"text": "10. Che cosa pensi della donazione di sangue?", "options": {"B": "√à una cosa bella", "R": "√à una cosa brutta", "Q": "Non ne sono sicuro/a"}}, "Q11": {"text": "11. Quando pensi alla donazione di sangue, come ti senti?", "options": {"F": "Felice", "T": "Triste", "N": "Non lo so"}}, "Q12": {"text": "12. Quando pensi a qualcuno che dona, come ti senti?", "options": {"F": "Felice", "T": "Triste", "N": "Non lo so"}}, "Q13": {"text": "13. Immaginando te da grande, cosa faresti?", "options": {"S": "Vorrei donare il sangue", "N": "Non vorrei donare il sangue", "Q": "Non ne sono sicuro/a"}}, "Q14": {"text": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "options": {"S": "S√¨", "N": "No", "Q": "Non ne sono sicuro/a"}}, "Q15": {"text": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "options": {"T": "Tutti i giorni", "S": "Almeno una volta a settimana", "M": "Almeno una volta al mese", "Q": "Quasi mai", "X": "Mai"}}, "Q16": {"text": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "options": {"T": "Tutti i giorni", "S": "Almeno una volta a settimana", "M": "Almeno una volta al mese", "Q": "Quasi mai", "X": "Mai"}}, "Q17": {"text": "17. Giochi pi√π spesso a:", "options": {"M": "Giochi in cui devi muoverti", "P": "Giochi in cui devi pensare"}}, "Q18": {"text": "18. Preferisci:", "options": {"M": "Giochi in cui devi muoverti", "P": "Giochi in cui devi pensare"}}, "Q19": {"text": "19. Preferisci giochi in cui:", "options": {"E": "Devi risolvere enigmi", "C": "Devi scoprire cose", "A": "Devi aiutare gli altri", "P": "Devi collezionare premi", "X": "Devi sconfiggere gli altri"}}, "Q20_1": {"text": "20. Gioco preferito 1", "type": "text"}, "Q20_2": {"text": "20. Gioco preferito 2", "type": "text"}, "Q20_3": {"text": "20. Gioco preferito 3", "type": "text"}, "Q21": {"text": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "options": {"P": "Piastrina", "R": "Globulo rosso", "B": "Globulo bianco", "M": "Plasma"}}, "Q22": {"text": "22. Quali sono i gruppi sanguigni?", "options": {"A": "A, B, AB, 0", "D": "A, B, C, D", "P": "Plasma, sangue e globuli rossi", "X": "X, Y, XY, XX"}}, "Q23": {"text": "23. Chi tra queste persone pu√≤ donare sangue?", "options": {"L": "Luisa di 10 anni", "C": "Cristiano di 75 anni", "G": "Giovanna di 45 anni", "S": "Simone di 16 anni"}}, "Q24": {"text": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "options": {"A": "AB", "0": "0 (Zero)", "C": "C", "X": "XY"}}, "Q25": {"text": "25. Cosa √® AVIS?", "options": {"A": "Associazione Vaccinati Italiani Sanitari", "V": "Assistenza Volontari Individuali Sangue", "S": "Associazione Volontari Italiani Sangue", "O": "Assemblea Veri Ispiratori Solidali"}}, "Q26": {"text": "26. Chi sono i donatori di sangue?", "options": {"P": "Persone scelte dagli ospedali per donare periodicamente", "M": "Medici e infermieri che curano le persone", "C": "Persone comuni che vogliono dare il proprio sangue volontariamente", "D": "Persone comuni che sono pagate per dare il proprio sangue"}}, "Q27": {"text": "27. Quando √® utilizzato il sangue donato?", "options": {"C": "Solo in caso di operazioni chirurgiche molto difficili", "M": "Solo se sono presenti delle malattie del sangue", "E": "Solo in caso di emergenze al pronto soccorso", "T": "In caso di emergenza, operazioni chirurgiche, nella cura di malattie di sangue e in altre terapie"}}, "Q28": {"text": "28. In questi ultimi giorni, quanto sei felice?", "options": {"A": "‚òπÔ∏è Per niente felice", "B": "üòê Poco felice", "C": "üôÇ Abbastanza felice", "D": "üòÑ Molto felice"}}, "Q29": {"text": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "options": {"A": "‚òπÔ∏è Per niente soddisfatta/o", "B": "üòê Poco soddisfatta/o", "C": "üôÇ Abbastanza soddisfatta/o", "D": "üòÑ Molto soddisfatta/o"}}, "Q30": {"text": "30. Quanto sei contenta/o della tua vita a casa?", "options": {"A": "‚òπÔ∏è Per niente contenta/o", "B": "üòê Poco contenta/o", "C": "üôÇ Abbastanza contenta/o", "D": "üòÑ Molto contenta/o"}}, "Q31": {"text": "31. Biglietti regalo (0-10)", "type": "text"}};
    const statsData = {"Sesso": {"F": "60,0%", "M": "40,0%"}, "Q1": {"S": "20,0%", "N": "80,0%"}, "Q2": {"S": "40,0%", "N": "60,0%"}, "Q3": {"S": "0%", "N": "100%"}, "Q4": {"B": "100%", "N": "0%", "Q": "0%"}, "Q5": {"M": "0%", "T": "60,0%", "Q": "40,0%"}, "Q6": {"S": "60,0%", "N": "40,0%"}, "Q7": {"P": "20,0%", "U": "20,0%", "N": "60,0%"}, "Q8": {"S": "0%", "N": "40,0%", "Q": "60,0%"}, "Q9": {"S": "60,0%", "B": "0%", "N": "40,0%", "Q": "0%"}, "Q10": {"B": "80,0%", "R": "0%", "Q": "20,0%"}, "Q11": {"F": "60,0%", "T": "0%", "N": "40,0%"}, "Q12": {"F": "80,0%", "T": "0%", "N": "20,0%"}, "Q13": {"S": "60,0%", "N": "20,0%", "Q": "20,0%"}, "Q14": {"S": "40,0%", "N": "0%", "Q": "60,0%"}, "Q15": {"T": "40,0%", "S": "40,0%", "M": "0%", "Q": "20,0%", "X": "0%"}, "Q16": {"T": "60,0%", "S": "40,0%", "M": "0%", "Q": "0%", "X": "0%"}, "Q17": {"M": "80,0%", "P": "20,0%"}, "Q18": {"M": "80,0%", "P": "20,0%"}, "Q19": {"E": "40,0%", "C": "60,0%", "A": "20,0%", "P": "20,0%", "X": "20,0%"}, "Q20_1": {"UNO": "20,0%", "JUST DANCE": "20,0%", "AVATAR DARTGRD": "20,0%", "FIFA": "20,0%", "NASCONDINO": "20,0%"}, "Q20_2": {"MONOPOLY": "20,0%", "MARIO KART": "20,0%", "JUST DANCE": "20,0%", "GIOCO DELL'OCA": "20,0%", "ACCHIAPPARELLA": "20,0%"}, "Q20_3": {"ROBLOX": "20,0%", "ANIMAL CROSSING": "20,0%", "WARIO WARE": "20,0%", "FORZA 4": "20,0%", "PALESTRA": "20,0%"}, "Q21": {"P": "20,0%", "R": "20,0%", "B": "20,0%", "M": "40,0%"}, "Q22": {"A": "0%", "D": "40,0%", "P": "60,0%", "X": "0%"}, "Q23": {"L": "0%", "C": "20,0%", "G": "60,0%", "S": "20,0%"}, "Q24": {"A": "60,0%", "0": "0%", "C": "0%", "X": "40,0%"}, "Q25": {"A": "40,0%", "V": "0%", "S": "60,0%", "O": "0%"}, "Q26": {"P": "0%", "M": "0%", "C": "60,0%", "D": "40,0%"}, "Q27": {"C": "0%", "M": "20,0%", "E": "40,0%", "T": "40,0%"}, "Q28": {"A": "0%", "B": "0%", "C": "20,0%", "D": "80,0%"}, "Q29": {"A": "0%", "B": "0%", "C": "100%", "D": "0%"}, "Q30": {"A": "0%", "B": "0%", "C": "20,0%", "D": "80,0%"}, "Q31": {"10": "40,0%", "S√¨": "20,0%", "5": "20,0%", "6": "20,0%"}};
    
    let filteredData = allData;
    let openQuestionnaireIndex = -1; 
    let currentModalQuestionIndex = -1;

    renderList();
    updateViewMode();

    function updateViewMode() {
        const header = document.getElementById('mainHeader');
        const title = document.getElementById('mainTitle');
        const homeBtn = document.getElementById('homeBtn');
        const printBtn = document.getElementById('printBtn');
        const searchArea = document.getElementById('searchArea');
        const items = document.querySelectorAll('.q-item');

        if (openQuestionnaireIndex !== -1) {
            header.classList.add('active-green');
            const item = filteredData[openQuestionnaireIndex];
            title.innerHTML = `${item.id} <span style="font-size:0.85em; opacity:0.95">(${item.opt_perc})</span>`;
            
            homeBtn.style.display = 'inline-block';
            printBtn.style.display = 'inline-block';
            searchArea.classList.add('hidden');
            
            items.forEach((el, idx) => {
                if (idx === openQuestionnaireIndex) {
                    el.classList.remove('hidden'); el.classList.add('open');
                } else {
                    el.classList.add('hidden'); el.classList.remove('open');
                }
            });
            document.querySelector('.list-viewport').scrollTop = 0;
        } else {
            header.classList.remove('active-green');
            title.innerText = "Questionari AVIS";
            homeBtn.style.display = 'none';
            printBtn.style.display = 'none';
            searchArea.classList.remove('hidden');
            items.forEach(el => { el.classList.remove('hidden'); el.classList.remove('open'); });
        }
    }

    function goHome() {
        openQuestionnaireIndex = -1;
        updateViewMode();
    }

    function updateResultsCount() {
        const count = filteredData.length;
        document.getElementById('resultsCount').innerText = `${count} ${count === 1 ? 'questionario' : 'questionari'}`;
        document.getElementById('clearSearch').style.display = document.getElementById('searchInput').value ? 'block' : 'none';
    }

    function clearSearch() {
        document.getElementById('searchInput').value = '';
        filterList();
    }

    function renderList() {
        const listEl = document.getElementById('qList');
        listEl.innerHTML = '';
        
        filteredData.forEach((item, index) => {
            const li = document.createElement('li');
            li.className = 'q-item';
            li.setAttribute('data-print-title', "Questionario: " + item.id + " | Ottimismo: " + item.opt_perc);
            
            let answersHtml = '';
            item.answers.forEach((ans, i) => {
                answersHtml += `<div class="qa-row" onclick="openQuestionModal(${index}, ${i})"><span class="question">${ans.q}</span><span class="answer">${ans.a_html}</span></div>`;
            });

            li.innerHTML = `
                <div class="q-header" onclick="selectItem(${index})">
                    <div>
                        <span>${item.id}</span>
                        <span style="font-size:0.8em; opacity:0.7">${item.sex_label}</span>
                        <span class="opt-badge">${item.opt_perc}</span>
                    </div>
                    <span>&#9662;</span>
                </div>
                <div class="q-details"><div class="q-details-content">${answersHtml}</div></div>
            `;
            listEl.appendChild(li);
        });
        updateResultsCount();
    }

    function selectItem(index) { openQuestionnaireIndex = index; updateViewMode(); }

    function navigate(direction) {
        const max = filteredData.length - 1;
        if (max < 0) return;
        let newIdx = openQuestionnaireIndex + direction;
        if (openQuestionnaireIndex === -1) newIdx = direction > 0 ? 0 : max;
        else {
            if (newIdx < 0) newIdx = 0;
            if (newIdx > max) newIdx = max;
        }
        openQuestionnaireIndex = newIdx;
        updateViewMode();
    }

    function filterList() {
        const q = document.getElementById('searchInput').value.toUpperCase();
        filteredData = (!q) ? allData : allData.filter(i => i.id.includes(q));
        openQuestionnaireIndex = -1;
        renderList();
        updateViewMode();
    }

    function openQuestionModal(qIdx, ansIdx) {
        openQuestionnaireIndex = qIdx; currentModalQuestionIndex = ansIdx;
        updateModalContent();
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    function updateModalContent() {
        const person = filteredData[openQuestionnaireIndex];
        const ans = person.answers[currentModalQuestionIndex];
        const def = decodingMap[ans.key];
        const stats = statsData[ans.key] || {};

        document.getElementById('modalTitle').innerText = def ? def.text : ans.q;
        const listEl = document.getElementById('modalList');
        listEl.innerHTML = '';

        if (def && def.options) {
            for (const [k, v] of Object.entries(def.options)) {
                const li = document.createElement('li');
                li.className = 'modal-option' + ((ans.raw_val === k || (ans.key === 'Q19' && ans.raw_val.includes(k))) ? ' selected' : '');
                li.innerHTML = `<span>${v}</span> <span class="perc-badge">${stats[k] || "0%"}</span>`;
                listEl.appendChild(li);
            }
        } else {
            listEl.innerHTML = `<li class="modal-option selected">Risposta: ${ans.raw_val || "-"}</li>`;
        }
    }

    function navModalQuestion(dir) {
        const person = filteredData[openQuestionnaireIndex];
        let newIdx = currentModalQuestionIndex + dir;
        if (newIdx >= 0 && newIdx < person.answers.length) {
            currentModalQuestionIndex = newIdx;
            updateModalContent();
        }
    }

    function closeModal(e) { if (!e || e.target.id === 'modalOverlay' || e.target.classList.contains('close-modal')) document.getElementById('modalOverlay').style.display = 'none'; }

    document.addEventListener('keydown', e => {
        if (document.getElementById('modalOverlay').style.display === 'flex') {
            if (e.key === 'ArrowRight') navModalQuestion(1);
            if (e.key === 'ArrowLeft') navModalQuestion(-1);
            if (e.key === 'Escape') closeModal();
        } else {
            if (e.key === 'ArrowRight') navigate(1);
            if (e.key === 'ArrowLeft') navigate(-1);
        }
    });
</script>
</body>
</html>
    