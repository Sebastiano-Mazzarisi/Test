<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Questionari AVIS</title>
<meta name="theme-color" content="#667eea">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
    background: #f5f5f5; color: #333; 
    height: 100vh;
    display: flex; flex-direction: column;
    overflow: hidden; 
}
body.modal-open { overflow: hidden; }

.header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.8rem; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex-shrink: 0; }
.header-content { max-width: 100%; margin: 0 auto; display: flex; flex-direction: row; justify-content: space-between; align-items: center; padding: 0 1rem; }
.header h1 { font-size: 1.2rem; font-weight: 600; }
/* Titolo centrato SOLO quando NON siamo in detail-mode */
.header-content:not(.detail-mode) { justify-content: center; }
.header-content:not(.detail-mode) h1 { text-align: center; }
.header-buttons { display: flex; gap: 0.5rem; }

@media (max-width: 768px) {
    .header-content.detail-mode { flex-direction: column; gap: 0.5rem; align-items: center; }
    .header-content.detail-mode h1 { font-size: 1rem; text-align: center; }
    .header-content.detail-mode .header-buttons { justify-content: center; width: 100%; }
    
    /* Ottimizzazioni menu mobile */
    .menu .menu-item-sex { display: none; }
    .menu .menu-item { 
        padding: 2px !important; 
        gap: 4px !important;
    }
    .menu .menu-item-left { gap: 4px !important; }
    .menu .menu-item-id { 
        font-size: 0.85rem !important; 
        font-weight: 600 !important;
    }
    .menu .opt-badge { 
        font-size: 0.7rem !important; 
        padding: 0.2rem 0.4rem !important;
    }
}

.btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0.4rem; border-radius: 6px; cursor: pointer; font-size: 1.1rem; transition: all 0.2s; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
.btn:hover { background: rgba(255,255,255,0.3); }

/* CONTAINER WITH SCROLL */
.container { 
    flex-grow: 1; width: 100%; padding: 0.5rem; 
    overflow-y: auto; display: flex; flex-direction: column;
}

/* MENU STYLE */

        .menu { display: flex; flex-direction: column; gap: 10px; max-width: 1200px; margin: 0 auto; }
        

.menu-item { background: white; padding: 1rem 1.625rem; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s; }
.menu-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-2px); }
.menu-item-left { display: flex; align-items: center; gap: 0.8rem; }
.menu-item-id { font-weight: 600; font-size: 1.1rem; color: #667eea; }
.menu-item-sex { font-size: 0.85rem; color: #666; background: #f0f0f0; padding: 0.2rem 0.5rem; border-radius: 4px; }
.opt-badge { background: #e8e8e8; color: #1a1a1a; padding: 0.3rem 0.7rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600; box-shadow: 0 1px 3px rgba(0,0,0,0.15); border: 1px solid #d0d0d0; }

/* DETAIL LAYOUT */
.detail { display: none; width: 100%; }
.detail.active { display: block; }

/* MOBILE DEFAULT (1 Column) */
.layout-columns {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding-bottom: 100px; /* Spazio per scroll su mobile */
}
.col-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* TABLET LAYOUT (2 Columns) - Min 600px, Max 1023px */
@media (min-width: 600px) and (max-width: 1023px) {
    .layout-columns {
        flex-direction: row;
        flex-wrap: wrap; /* Permette a col-group di andare a capo */
        gap: 10px;
        padding-bottom: 50px;
    }
    .col-group {
        flex: 1 1 48%; /* Prende il 48% della larghezza (2 per riga) */
        min-width: 48%;
    }
}

/* DESKTOP LAYOUT (4 Columns) - Min 1024px */
@media (min-width: 1024px) {
    /* Rimuovi overflow:hidden su container per permettere lo scroll se il contenuto √® lungo */
    .container { overflow-y: auto; } 
    
    .layout-columns {
        flex-direction: row;
        flex-wrap: nowrap; /* Forza una riga sola */
        height: auto; /* Lascia che l'altezza cresca */
        min-height: 100%;
        gap: 15px;
        padding-bottom: 20px;
    }
    .col-group {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start; /* Non forzare space-between che sparpaglia troppo se poche domande */
        gap: 8px; 
    }
    .qa-item {
        flex-grow: 0; /* Non forzare crescita eccessiva */
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 8px 10px; 
        margin-bottom: 0;
        min-height: 0; 
    }
    .qa-question {
        font-size: 0.8rem; 
        margin-bottom: 4px;
        white-space: normal; /* Permetti a capo */
    }
    .qa-answer {
        font-size: 0.85rem;
        padding-left: 8px;
        border-left-width: 2px;
    }
}

.qa-item { 
    background: white; padding: 10px; border-radius: 6px; 
    box-shadow: 0 1px 2px rgba(0,0,0,0.05); border: 1px solid #e0e0e0; cursor: pointer; 
}
.qa-question { font-weight: 600; color: #667eea; margin-bottom: 3px; font-size: 0.9rem; line-height: 1.2; }
.qa-answer { color: #333; font-size: 0.9rem; line-height: 1.2; padding-left: 8px; border-left: 3px solid #667eea; }
.qa-item.no-answer, .qa-item.multiple-answers, .qa-item.logic-error { background: #fff0f0; border-color: #ffcccc; }
.qa-item.no-answer .qa-answer, .qa-item.multiple-answers .qa-answer, .qa-item.logic-error .qa-answer { border-left-color: #d32f2f; color: #d32f2f; }

/* Cornici speciali per campi specifici */
.qa-item.text-field { border: 3px solid #28a745; box-shadow: 0 2px 4px rgba(40, 167, 69, 0.2); }
.qa-item.multi-choice { border: 3px solid #ffc107; box-shadow: 0 2px 4px rgba(255, 193, 7, 0.2); }


/* MODALS */
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; padding: 1rem; }
.modal-content { background: white; border-radius: 12px; padding: 2rem; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3); color: #333; }
.modal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px solid #667eea; }
.modal-close { background: none; border: none; font-size: 2rem; color: #999; cursor: pointer; margin-left: 1rem; }
.modal-title { font-weight: 600; font-size: 1.1rem; color: #1a1a2e; }

.option-wrapper { display: flex; flex-direction: column; border-bottom: 1px solid #eee; padding: 10px 0; }
.option-row { font-size: 1rem; color: #555; padding: 0 12px; margin-bottom: 4px; display: flex; justify-content: space-between; align-items: center; }
.option-row.selected { color: #155724; font-weight: 700; }
.option-row strong { font-size: 2rem; margin-right: 10px; line-height: 1; }
.stat-bar-container { width: 100%; height: 20px; position: relative; padding: 0 12px; display: flex; align-items: center; }
.stat-bar { height: 8px; border-radius: 4px; opacity: 0.6; }
.stat-text { font-size: 0.75rem; color: #888; margin-left: 10px; min-width: 40px; }

#loadingOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 2000; justify-content: center; align-items: center; flex-direction: column; }
.spinner { width: 50px; height: 50px; border: 5px solid #ccc; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* SERENITY TABLE */
.serenity-breakdown-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
.serenity-breakdown-table th { background: #667eea; color: white; padding: 10px; text-align: left; font-weight: 600; }
.serenity-breakdown-table td { padding: 10px; border-bottom: 1px solid #e0e0e0; vertical-align: top; }
.serenity-breakdown-table tr:hover { background: #f5f5f5; }
.breakdown-question { font-weight: 600; color: #667eea; margin-bottom: 5px; }
.breakdown-answer { color: #555; font-size: 0.9rem; }
.breakdown-points { text-align: right; font-weight: 600; color: #28a745; vertical-align: middle; }
.breakdown-total { background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: bold; font-size: 1.2rem; padding: 15px; text-align: center; border-radius: 8px; margin-top: 15px; }

/* GAMES MODAL */
.games-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px; }
.games-column { background: #f9f9f9; padding: 15px; border-radius: 8px; }
.games-column h3 { color: #667eea; font-size: 1.1rem; margin-bottom: 15px; text-align: center; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
.games-column ul { list-style: none; padding: 0; margin: 0; max-height: 400px; overflow-y: auto; }
.games-column li { padding: 8px 12px; margin-bottom: 5px; background: white; border-radius: 6px; border-left: 3px solid #667eea; display: flex; justify-content: space-between; align-items: center; }
.games-column li:hover { background: #f0f0f0; }
.game-name { font-weight: 500; color: #333; }
.game-count { font-weight: bold; color: #667eea; background: #e8ecff; padding: 2px 8px; border-radius: 12px; font-size: 0.9rem; }
@media (max-width: 768px) { .games-columns { grid-template-columns: 1fr; } }

.opt-badge { cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
.opt-badge:hover { transform: scale(1.05); box-shadow: 0 3px 8px rgba(0,0,0,0.25); background: #d8d8d8; }
</style>
</head>
<body>

<div id="loadingOverlay"><div class="spinner"></div><p style="margin-top: 20px; color: #667eea; font-weight: bold;">üîÑ Ricaricamento...</p></div>

<div class="header">
    <div class="header-content">
        <h1 id="title">Questionari AVIS</h1>
        <div class="header-buttons">
            <button class="btn" id="prevBtn" style="display:none" onclick="navigate(-1)">‚Üê</button>
            <button class="btn" id="homeBtn" style="display:none" onclick="goBack()">üè†</button>
            <button class="btn" id="viewBtn" style="display:none" onclick="viewPDF()">üîç</button>
            <button class="btn" id="printBtn" style="display:none" onclick="printPDF()">üñ®Ô∏è</button>
            <button class="btn" id="nextBtn" style="display:none" onclick="navigate(1)">‚Üí</button>
        </div>
    </div>
</div>

<div id="mainContainer" class="container">
    <div id="menu" class="menu"></div>
    <div id="detail" class="detail"></div>
</div>

<div id="questionModal" class="modal-overlay" onclick="closeModal('questionModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header"><div id="qModalTitle" class="modal-title"></div><button class="modal-close" onclick="closeModal('questionModal')">&times;</button></div>
        <div id="qModalContent"></div>
    </div>
</div>

<div id="serenityModal" class="modal-overlay" onclick="closeModal('serenityModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header"><div class="modal-title">üòä Dettaglio Calcolo Indice di Serenit√†</div><button class="modal-close" onclick="closeModal('serenityModal')">&times;</button></div>
        <div id="serenityModalContent"></div>
    </div>
</div>

<div id="gameModal" class="modal-overlay" onclick="closeModal('gameModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header"><div class="modal-title">üèÄ Dettaglio Calcolo Indice di Gioco</div><button class="modal-close" onclick="closeModal('gameModal')">&times;</button></div>
        <div id="gameModalContent"></div>
    </div>
</div>

<script>
const allData = [{"id": "MA-ONOFRIO", "sex": "Maschio", "serenity_opt": "üòä 100%", "game_opt": "üèÄ 50%", "answers": [{"q": "1. Hai mai sentito parlare di sistema trasfusionale?", "key_id": "Q01", "raw": "B", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "No", "a_html": "No"}, {"q": "2. Hai mai sentito parlare dei gruppi sanguigni?", "key_id": "Q02", "raw": "A", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "S√¨", "a_html": "S√¨"}, {"q": "3. Sai che gruppo sanguigno hai tu?", "key_id": "Q03", "raw": "B", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "No", "a_html": "No"}, {"q": "3b. Se hai risposto s√¨, sapresti dire quale?", "key_id": "Q03-T", "raw": "NO", "options": null, "is_text": true, "error": "logic-error", "a": "NO", "a_html": "<strong>NO</strong>"}, {"q": "4. Cosa pensi significhi 'donazione di sangue'?", "key_id": "Q04", "raw": "A", "options": {"A": "Dare sangue a chi ne ha bisogno", "B": "Dare sangue in cambio di denaro", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "Dare sangue a chi ne ha bisogno", "a_html": "Dare sangue a chi ne ha bisogno"}, {"q": "5. Cosa pensi significhi 'trasfusione di sangue'?", "key_id": "Q05", "raw": "C", "options": {"A": "Modificare il sangue di una persona", "B": "Trasferire sangue in una persona", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "Non ne sono sicuro/a", "a_html": "Non ne sono sicuro/a"}, {"q": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "key_id": "Q06", "raw": "B", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "No", "a_html": "No"}, {"q": "7. Conosci qualcuno che ha donato Sangue?", "key_id": "Q07", "raw": "C", "options": {"A": "S√¨, pi√π di una persona", "B": "S√¨, una sola persona", "C": "Nessuno"}, "is_text": false, "error": null, "a": "Nessuno", "a_html": "Nessuno"}, {"q": "8. Conosci qualcuno che ha donato Plasma?", "key_id": "Q08", "raw": "C", "options": {"A": "S√¨", "B": "No", "C": "Non so cos'√® il plasma"}, "is_text": false, "error": null, "a": "Non so cos'√® il plasma", "a_html": "Non so cos'√® il plasma"}, {"q": "9. Secondo te quanto √® importante donare sangue?", "key_id": "Q09", "raw": "A", "options": {"A": "√à molto importante", "B": "√à abbastanza importante", "C": "Non √® importante"}, "is_text": false, "error": null, "a": "√à molto importante", "a_html": "√à molto importante"}, {"q": "10. Che cosa pensi della donazione di sangue?", "key_id": "Q10", "raw": "A", "options": {"A": "√à una cosa bella", "B": "√à una cosa brutta", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "√à una cosa bella", "a_html": "√à una cosa bella"}, {"q": "11. Quando pensi alla donazione di sangue, come ti senti?", "key_id": "Q11", "raw": "A", "options": {"A": "Felice", "B": "Triste", "C": "Non lo so"}, "is_text": false, "error": null, "a": "Felice", "a_html": "Felice"}, {"q": "12. Quando pensi a qualcuno che dona, come ti senti?", "key_id": "Q12", "raw": "C", "options": {"A": "Felice", "B": "Triste", "C": "Non lo so"}, "is_text": false, "error": null, "a": "Non lo so", "a_html": "Non lo so"}, {"q": "13. Immaginando te da grande, cosa faresti?", "key_id": "Q13", "raw": "C", "options": {"A": "Vorrei donare il sangue", "B": "Non vorrei donare il sangue", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "Non ne sono sicuro/a", "a_html": "Non ne sono sicuro/a"}, {"q": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "key_id": "Q14", "raw": "C", "options": {"A": "S√¨", "B": "No", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "Non ne sono sicuro/a", "a_html": "Non ne sono sicuro/a"}, {"q": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "key_id": "Q15", "raw": "D", "options": {"A": "Tutti i giorni", "B": "Almeno una volta a settimana", "C": "Almeno una volta al mese", "D": "Quasi mai", "E": "Mai"}, "is_text": false, "error": null, "a": "Quasi mai", "a_html": "Quasi mai"}, {"q": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "key_id": "Q16", "raw": "B", "options": {"A": "Tutti i giorni", "B": "Almeno una volta a settimana", "C": "Almeno una volta al mese", "D": "Quasi mai", "E": "Mai"}, "is_text": false, "error": null, "a": "Almeno una volta a settimana", "a_html": "Almeno una volta a settimana"}, {"q": "17. Giochi pi√π spesso a:", "key_id": "Q17", "raw": "A", "options": {"A": "Giochi in cui devi muoverti", "B": "Giochi in cui devi pensare"}, "is_text": false, "error": null, "a": "Giochi in cui devi muoverti", "a_html": "Giochi in cui devi muoverti"}, {"q": "18. Preferisci:", "key_id": "Q18", "raw": "A", "options": {"A": "Giochi in cui devi muoverti", "B": "Giochi in cui devi pensare"}, "is_text": false, "error": null, "a": "Giochi in cui devi muoverti", "a_html": "Giochi in cui devi muoverti"}, {"q": "19. Preferisci giochi in cui:", "key_id": "Q19", "raw": "AB", "options": {"A": "Risolvere enigmi", "B": "Scoprire cose", "C": "Aiutare gli altri", "D": "Collezionare premi/obiettivi", "E": "Sconfiggere gli altri"}, "is_text": false, "error": null, "a": "Risolvere enigmi, Scoprire cose", "a_html": "Risolvere enigmi, Scoprire cose"}, {"q": "20. Scrivi il nome dei 3 giochi a cui giochi pi√π spesso", "key_id": "Q20", "a": "JUST DANCE, MARIO KART, ANIMAL CROSSING", "a_html": "<strong>JUST DANCE, MARIO KART, ANIMAL CROSSING</strong>", "raw": "JUST DANCE, MARIO KART, ANIMAL CROSSING", "options": null, "is_text": true, "error": null}, {"q": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "key_id": "Q21", "raw": "C", "options": {"A": "Piastrina", "B": "Globulo rosso", "C": "Globulo bianco", "D": "Plasma"}, "is_text": false, "error": null, "a": "Globulo bianco", "a_html": "Globulo bianco"}, {"q": "22. Quali sono i gruppi sanguigni?", "key_id": "Q22", "raw": "C", "options": {"A": "A, B, AB, 0", "B": "A, B, C, D", "C": "Plasma, sangue e globuli rossi", "D": "X, Y, XY, XX"}, "is_text": false, "error": null, "a": "Plasma, sangue e globuli rossi", "a_html": "Plasma, sangue e globuli rossi"}, {"q": "23. Chi tra queste persone pu√≤ donare sangue?", "key_id": "Q23", "raw": "D", "options": {"A": "Luisa di 10 anni", "B": "Cristiano di 75 anni", "C": "Giovanna di 45 anni", "D": "Simone di 16 anni"}, "is_text": false, "error": null, "a": "Simone di 16 anni", "a_html": "Simone di 16 anni"}, {"q": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "key_id": "Q24", "raw": "A", "options": {"A": "AB", "B": "0 (Zero)", "C": "C", "D": "XY"}, "is_text": false, "error": null, "a": "AB", "a_html": "AB"}, {"q": "25. Cosa √® AVIS?", "key_id": "Q25", "raw": "B", "options": {"A": "Assoc. Vaccinati Italiani Sanitari", "B": "Assistenza Volontari Sangue", "C": "Assoc. Volontari Italiani Sangue", "D": "Assemblea Veri Ispiratori"}, "is_text": false, "error": null, "a": "Assistenza Volontari Sangue", "a_html": "Assistenza Volontari Sangue"}, {"q": "26. Chi sono i donatori di sangue?", "key_id": "Q26", "raw": "C", "options": {"A": "Scelte dagli ospedali periodicamente", "B": "Medici e infermieri curanti", "C": "Persone comuni volontarie", "D": "Persone comuni pagate"}, "is_text": false, "error": null, "a": "Persone comuni volontarie", "a_html": "Persone comuni volontarie"}, {"q": "27. Quando √® utilizzato il sangue donato?", "key_id": "Q27", "raw": "D", "options": {"A": "Solo operazioni molto difficili", "B": "Solo malattie del sangue", "C": "Solo emergenze al pronto soccorso", "D": "Emergenze, operazioni e terapie"}, "is_text": false, "error": null, "a": "Emergenze, operazioni e terapie", "a_html": "Emergenze, operazioni e terapie"}, {"q": "28. In questi ultimi giorni, quanto sei felice?", "key_id": "Q28", "raw": "D", "options": {"A": "‚òπÔ∏è Per niente felice", "B": "üòê Poco felice", "C": "üôÇ Abbastanza felice", "D": "üòÑ Molto felice"}, "is_text": false, "error": null, "a": "üòÑ Molto felice", "a_html": "üòÑ Molto felice"}, {"q": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "key_id": "Q29", "raw": "D", "options": {"A": "‚òπÔ∏è Per niente soddisfatta/o", "B": "üòê Poco soddisfatta/o", "C": "üôÇ Abbastanza soddisfatta/o", "D": "üòÑ Molto soddisfatta/o"}, "is_text": false, "error": null, "a": "üòÑ Molto soddisfatta/o", "a_html": "üòÑ Molto soddisfatta/o"}, {"q": "30. Quanto sei contenta/o della tua vita a casa?", "key_id": "Q30", "raw": "D", "options": {"A": "‚òπÔ∏è Per niente contenta/o", "B": "üòê Poco contenta/o", "C": "üôÇ Abbastanza contenta/o", "D": "üòÑ Molto contenta/o"}, "is_text": false, "error": null, "a": "üòÑ Molto contenta/o", "a_html": "üòÑ Molto contenta/o"}, {"q": "31. Biglietti regalo (0-10)", "key_id": "Q31", "raw": "10", "options": null, "is_text": true, "error": null, "a": "10", "a_html": "<strong>10</strong>"}], "page_num": 2, "serenity_raw_data": {"Q10": "A", "Q11": "A", "Q28": "D", "Q29": "D", "Q30": "D", "Q31": "10"}, "game_raw_data": {"Q15": "D", "Q16": "B"}, "pdf_data": "JVBERi0xLjQKJZOMi54gUmVwb3J0TGFiIEdlbmVyYXRlZCBQREYgZG9jdW1lbnQgaHR0cDovL3d3dy5yZXBvcnRsYWIuY29tCjEgMCBvYmoKPDwKL0YxIDIgMCBSIC9GMiAzIDAgUiAvRjMgNCAwIFIgL0Y0IDUgMCBSCj4+CmVuZG9iagoyIDAgb2JqCjw8Ci9CYXNlRm9udCAvSGVsdmV0aWNhIC9FbmNvZGluZyAvV2luQW5zaUVuY29kaW5nIC9OYW1lIC9GMSAvU3VidHlwZSAvVHlwZTEgL1R5cGUgL0ZvbnQKPj4KZW5kb2JqCjMgMCBvYmoKPDwKL0Jhc2VGb250IC9IZWx2ZXRpY2EtQm9sZCAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyAvTmFtZSAvRjIgL1N1YnR5cGUgL1R5cGUxIC9UeXBlIC9Gb250Cj4+CmVuZG9iago0IDAgb2JqCjw8Ci9CYXNlRm9udCAvWmFwZkRpbmdiYXRzIC9OYW1lIC9GMyAvU3VidHlwZSAvVHlwZTEgL1R5cGUgL0ZvbnQKPj4KZW5kb2JqCjUgMCBvYmoKPDwKL0Jhc2VGb250IC9IZWx2ZXRpY2EtT2JsaXF1ZSAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyAvTmFtZSAvRjQgL1N1YnR5cGUgL1R5cGUxIC9UeXBlIC9Gb250Cj4+CmVuZG9iago2IDAgb2JqCjw8Ci9Db250ZW50cyAxMCAwIFIgL01lZGlhQm94IFsgMCAwIDU5NS4yNzU2IDg0MS44ODk4IF0gL1BhcmVudCA5IDAgUiAvUmVzb3VyY2VzIDw8Ci9Gb250IDEgMCBSIC9Qcm9jU2V0IFsgL1BERiAvVGV4dCAvSW1hZ2VCIC9JbWFnZUMgL0ltYWdlSSBdCj4+IC9Sb3RhdGUgMCAvVHJhbnMgPDwKCj4+IAogIC9UeXBlIC9QYWdlCj4+CmVuZG9iago3IDAgb2JqCjw8Ci9QYWdlTW9kZSAvVXNlTm9uZSAvUGFnZXMgOSAwIFIgL1R5cGUgL0NhdGFsb2cKPj4KZW5kb2JqCjggMCBvYmoKPDwKL0F1dGhvciAoXChhbm9ueW1vdXNcKSkgL0NyZWF0aW9uRGF0ZSAoRDoyMDI2MDIwNzE1MDY0OSswMScwMCcpIC9DcmVhdG9yIChcKHVuc3BlY2lmaWVkXCkpIC9LZXl3b3JkcyAoKSAvTW9kRGF0ZSAoRDoyMDI2MDIwNzE1MDY0OSswMScwMCcpIC9Qcm9kdWNlciAoUmVwb3J0TGFiIFBERiBMaWJyYXJ5IC0gd3d3LnJlcG9ydGxhYi5jb20pIAogIC9TdWJqZWN0IChcKHVuc3BlY2lmaWVkXCkpIC9UaXRsZSAoXChhbm9ueW1vdXNcKSkgL1RyYXBwZWQgL0ZhbHNlCj4+CmVuZG9iago5IDAgb2JqCjw8Ci9Db3VudCAxIC9LaWRzIFsgNiAwIFIgXSAvVHlwZSAvUGFnZXMKPj4KZW5kb2JqCjEwIDAgb2JqCjw8Ci9GaWx0ZXIgWyAvQVNDSUk4NURlY29kZSAvRmxhdGVEZWNvZGUgXSAvTGVuZ3RoIDI1NzIKPj4Kc3RyZWFtCkdhdWBWPkJBT1cnN0tWWWZVI0BnTmU2MzM5NCdfUFJeaGNlZ1BNZCNhWSw+QmFsbFFzX0ZscVI/aU1dQ1JaKE4kNzF1aTRhND5bRDRNMDYvTV4mRT9KIXAyK20vVUlxaVBjYD9ONUtyRDlHLlp0aHIrMihqU11EQSxyMWFFLHNZP0Q3bCNnRkhXJmtkJyQ6TllwZk9BTW41cislO0EoOjU4dVFnYHIsQDhdbi8oIUxYRS5kZD1dWmplWFEvbmdFLmZULGFASmReWWFFQS5fUkp0JjZmUTRDOjxXKjdyVD0yc1ZaN09Waz8iIU9EbSVFaWdqQFU6JHFuKTxBKyVUbm5AcFYuJ1xYK180Xi5eUzY5IVQyVztwZzwqITw7NTNcTzNTLDoqNCJKNVExIV9eZkFzYXNxZDZkSTA4JVFPKFBCMjhtZXIhS3I4J1pPIV9bOilIanRmNCtyLSc4R09nImZ0SlVAL3JjTSxgMU5KYD1VJyU4WVYjTGksIWRvcWdrWlM0bVshRDFbYj81LiZfZDghSEg2ZnIxWFllbj85c1dmIUgxWUZeOFloaSNQIW1SUHMmO0JQWkY/XSNJXkcwKFBWdVxdVCtkNEgnRSoxLl9aXCkuYjguNDVENHRfPTcqZFpMVipuLHBaJ1dvRG9QV1FiZmpRLGAqMGBFNTxwMihrXjgpZkUiSzxIJkFSaCNKOlQlKFEnVytMXyxDNmNRSmV1ZltlbC1PIl1hPGdSMm5tSSpoI0cwTTBfKUJXbDwsT3JkOVU6L1QsTEdYbl9ZZ3QlU2ZHUkZSJ2AmYk5WSFlmX3BnQyFCPUtzcFQnMyhiVDpAKTtpRUtUOiMwbzdYQyUhKjVWY1AsZl0qaF1mcUpfbTIyRl4xbz9zKWswOyk3IWA1JzlsJHUhQCFdVFZyMk44P0QrJkJfI05sXkA5QkFGWTk5blEpJmEvM2dZY2lIKlA5YytrVCssVlZZZU9SXSROUlVcbj5eNFttLjdOZm9iZjl1YGFHRWpCNlJJSjVAVD83JGImayNyMFtmQi5TVTFdWW0/S0Y1TUlDNTArQWkkPS9GLkxcMkAhN2dXZGJWNikkb2xcS1tfVjhkKDM8JjxUZFosO0Y+YTA5KFtDODRsZXVWVFAsPXJNSUZlZjlpWT9XdSdMMSItMTtHPGpNcjBxWl5WMWo3IUVWbWUwIzcpImpITEZcZikhI14pXE5mTVpRMi9JRHBsRnApPlVxMS0+XVhbY01xPF4pWT5SJGErLHMmVCliQmhHPHRVVWZBLEBtc2lCS0wqViQrLV1jaCkwYy8yMjtBIWwhI1YpZ0tBSF1BKSdTWkk3MnVIbF1QMEYhUk5pUTFJYF5VJlRaNkNEVzxlKXVuckhuZi9UZT5KNSQya3VkUjQ4NWtUcHVfZ2ZyI1ptLyVKaiFJTyFiTERxZV0jdGBAXCxSJj8qQy5HaThrYmphMD9pZGc9VFFQKEo3KThbLWhYLkFUZVpTT1AqNidWcCZJL3AuYlQkaW9faTtIZV07ZS0iLUFRdDI6a1xBbDhyWlorYCg6ciViOzUicGk4Lk4pWjEva2VvZmgjZEtTWiEiQEooLS5ZMTEuJ1woMyZPIzZbViMxKW5KLlQ4OEhUKz5iMDMvQS9samE2YDhXZjExP3UrOV06cmcwcV9nTF1eRzgnaCJSSUxyNV5wMFVZR15vOTlwLWtcUiZlN2slbTplNWo5aUhOIldUYTV1MV9pQEBgK2E4cU02X1llNlUuJC8rZ29OUkBLSjVcV05hNixRMzhML24sSG1ULGhtcmoibThqL0Y7M3Q5cF8rMU8vSlNcRUtoX1koYiIqaW1GU3JISVYiZSEpLFdTO2xAMixVLGpbMDRhZV5ZT0ZRazM8QXBeS0NyUmcjPDI/Y2smMVdrcEVwPUUlXV8yXG11IV81NU8salclMFUyTSRhay88LEQtKFBAM1Ejcm4lVTItLzR0XmpVPW42U1BEWDtzQWxrcUYqOCxEKTRqclsoW1xnP28wK01MMDRrcT9jcl9SI3BFNUJZPGg+L3M9LTVdO1clNUlwVkxRK0Itb2lNdSYjIk9cLyhcVDomV0xUaitEanUnODBIV2Qha29gQElkRms7VSJpPmFuaks3X1RxbFwxWihlYUhMO1Y3bDs0MyxDM2o/KmFzLCpwMiNgdVNTOyZnZylLWiYoPmBnUj1aYzRna1VgY1NWTjg2XE4hPm47aTpSPCxhKkhsWFI0WjJaZylsSl5RYiheIU9sYEpDO1F0S0lKKTEvNXVPdXFrOiZTakU1ZnM7Ylc0cVVUJHJcIik5Om8jTk46OV48KC9DWmB0JWAhQDxxSjZbOUZqQU1iSyw4N0NiXCs/cmhycmoiWzAlazQyVylfPkJRRSI3Ly1bUUNnRzxFQUwmLmwmNHI0M21nUUJCSVRDLU1taTonb2taTS5dWCRAUHByQjUvRGdlZ0BkTFpZbiRXSC5OWCQmVFYzV2JCJEBoRipZSjc5bG5GUTVBZWEhQkQvP2RDJ2kuJnI5b2BDR0drODI+IWk3N01OQzM9dU5rMlhyQkhIXW5hVEg7IygrOVJqUm5OXTpvT2pNXDtIc0E3cjBeaClVVUksTyFhWUxua2ItJWtra0QtRmxmOSNSST1dKyF1OEJHYi8vaS9STFFxPDoqbGokTCJHWCFBZ1ZXWmNCVTgoTmAiSSo5aUY0ZUghOSchNCFpI0FWcVZYYGpYMUM1ZSJJQGJuQSY5QHUkQDhIIURyS1tgJW1yMT4yQEB1LzI0VlpVbzJeNzdxTFNCdVZwMDBcMmpIYyhhJUVEQ1w6UkBtZ3BmSllOOmdaXWg/X3RJVikkYzZIXT5RcidtPW4hZEElMVorYCZKNHUpb1gkTStrPCJCOTk4Yy4mUzxCZSFKTUVqVEVgJF5eXG0sPmpUQjBdJCJobCNtcVMrMDI+aSM4R00yOTglKVNLaCxQLV5GVV0kOHUlJDE2bzFSLl1BcDhYK3VcYzpfZDM2Z1JQOyE7bEJtUmd0OmdFKFxQZUU+NGItTSU3XChFU1ZCY248L0hlZUk5LDdrNlFmT25TRkBuOjxmc20uLEloZjM6ckdIaVhzPypOKT1DQ3B1IlFoZzdlIypYUUdhKyZJUkozOUhnIUk/LTg0J3M2LkxpYTgkMyE9YT9jSzs2OSZCY25JWiNWIURrMzhubEtIMjZRY1EiUTRkLU1taSooU2pbYE0tRmpKY2VZLisyUypidU1lXlRcZ0o1V2tkaVc9OT51YzhBSlktMFVXNSV1XzVQISU9SlFcNSlhYVFLJDdhT1hbYUtXaEgiRWNCdVI7VFtxJWssS2puNHVmKVg/TVtaMVlOP2ZgTEk6KkVGMWNrVi8+VURYTDklJmFJPy0pU0MqaHBzN29SLThSJElcYGteZiVwIytwMlVSMUxNfj5lbmRzdHJlYW0KZW5kb2JqCnhyZWYKMCAxMQowMDAwMDAwMDAwIDY1NTM1IGYgCjAwMDAwMDAwNzMgMDAwMDAgbiAKMDAwMDAwMDEzNCAwMDAwMCBuIAowMDAwMDAwMjQxIDAwMDAwIG4gCjAwMDAwMDAzNTMgMDAwMDAgbiAKMDAwMDAwMDQzNiAwMDAwMCBuIAowMDAwMDAwNTUxIDAwMDAwIG4gCjAwMDAwMDA3NTUgMDAwMDAgbiAKMDAwMDAwMDgyMyAwMDAwMCBuIAowMDAwMDAxMTA2IDAwMDAwIG4gCjAwMDAwMDExNjUgMDAwMDAgbiAKdHJhaWxlcgo8PAovSUQgCls8NTU4NDcxODZkMWYxN2FmNTcxYWY3ZDkwODU1MDBiYjA+PDU1ODQ3MTg2ZDFmMTdhZjU3MWFmN2Q5MDg1NTAwYmIwPl0KJSBSZXBvcnRMYWIgZ2VuZXJhdGVkIFBERiBkb2N1bWVudCAtLSBkaWdlc3QgKGh0dHA6Ly93d3cucmVwb3J0bGFiLmNvbSkKCi9JbmZvIDggMCBSCi9Sb290IDcgMCBSCi9TaXplIDExCj4+CnN0YXJ0eHJlZgozODI5CiUlRU9GCg=="}, {"id": "MA-TERESA", "sex": "Femmina", "serenity_opt": "üòä 53%", "game_opt": "üèÄ 63%", "answers": [{"q": "1. Hai mai sentito parlare di sistema trasfusionale?", "key_id": "Q01", "raw": "B", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "No", "a_html": "No"}, {"q": "2. Hai mai sentito parlare dei gruppi sanguigni?", "key_id": "Q02", "raw": "B", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "No", "a_html": "No"}, {"q": "3. Sai che gruppo sanguigno hai tu?", "key_id": "Q03", "raw": "B", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "No", "a_html": "No"}, {"q": "3b. Se hai risposto s√¨, sapresti dire quale?", "key_id": "Q03-T", "raw": "", "options": null, "is_text": true, "error": null, "a": "(nessuna risposta)", "a_html": "<span style=\"color:#999; font-style:italic;\">(nessuna risposta)</span>"}, {"q": "4. Cosa pensi significhi 'donazione di sangue'?", "key_id": "Q04", "raw": "A", "options": {"A": "Dare sangue a chi ne ha bisogno", "B": "Dare sangue in cambio di denaro", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "Dare sangue a chi ne ha bisogno", "a_html": "Dare sangue a chi ne ha bisogno"}, {"q": "5. Cosa pensi significhi 'trasfusione di sangue'?", "key_id": "Q05", "raw": "B", "options": {"A": "Modificare il sangue di una persona", "B": "Trasferire sangue in una persona", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "Trasferire sangue in una persona", "a_html": "Trasferire sangue in una persona"}, {"q": "6. Hai parlato di recente della donazione di sangue con qualcuno?", "key_id": "Q06", "raw": "A", "options": {"A": "S√¨", "B": "No"}, "is_text": false, "error": null, "a": "S√¨", "a_html": "S√¨"}, {"q": "7. Conosci qualcuno che ha donato Sangue?", "key_id": "Q07", "raw": "C", "options": {"A": "S√¨, pi√π di una persona", "B": "S√¨, una sola persona", "C": "Nessuno"}, "is_text": false, "error": null, "a": "Nessuno", "a_html": "Nessuno"}, {"q": "8. Conosci qualcuno che ha donato Plasma?", "key_id": "Q08", "raw": "C", "options": {"A": "S√¨", "B": "No", "C": "Non so cos'√® il plasma"}, "is_text": false, "error": null, "a": "Non so cos'√® il plasma", "a_html": "Non so cos'√® il plasma"}, {"q": "9. Secondo te quanto √® importante donare sangue?", "key_id": "Q09", "raw": "A", "options": {"A": "√à molto importante", "B": "√à abbastanza importante", "C": "Non √® importante"}, "is_text": false, "error": null, "a": "√à molto importante", "a_html": "√à molto importante"}, {"q": "10. Che cosa pensi della donazione di sangue?", "key_id": "Q10", "raw": "B", "options": {"A": "√à una cosa bella", "B": "√à una cosa brutta", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "√à una cosa brutta", "a_html": "√à una cosa brutta"}, {"q": "11. Quando pensi alla donazione di sangue, come ti senti?", "key_id": "Q11", "raw": "B", "options": {"A": "Felice", "B": "Triste", "C": "Non lo so"}, "is_text": false, "error": null, "a": "Triste", "a_html": "Triste"}, {"q": "12. Quando pensi a qualcuno che dona, come ti senti?", "key_id": "Q12", "raw": "A", "options": {"A": "Felice", "B": "Triste", "C": "Non lo so"}, "is_text": false, "error": null, "a": "Felice", "a_html": "Felice"}, {"q": "13. Immaginando te da grande, cosa faresti?", "key_id": "Q13", "raw": "C", "options": {"A": "Vorrei donare il sangue", "B": "Non vorrei donare il sangue", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "Non ne sono sicuro/a", "a_html": "Non ne sono sicuro/a"}, {"q": "14. Consiglieresti ad un adulto di donare sangue o plasma?", "key_id": "Q14", "raw": "A", "options": {"A": "S√¨", "B": "No", "C": "Non ne sono sicuro/a"}, "is_text": false, "error": null, "a": "S√¨", "a_html": "S√¨"}, {"q": "15. Quanto spesso giochi ai giochi da tavolo o di carte?", "key_id": "Q15", "raw": "C", "options": {"A": "Tutti i giorni", "B": "Almeno una volta a settimana", "C": "Almeno una volta al mese", "D": "Quasi mai", "E": "Mai"}, "is_text": false, "error": null, "a": "Almeno una volta al mese", "a_html": "Almeno una volta al mese"}, {"q": "16. Quanto spesso giochi su cellulare, tablet, computer o console?", "key_id": "Q16", "raw": "B", "options": {"A": "Tutti i giorni", "B": "Almeno una volta a settimana", "C": "Almeno una volta al mese", "D": "Quasi mai", "E": "Mai"}, "is_text": false, "error": null, "a": "Almeno una volta a settimana", "a_html": "Almeno una volta a settimana"}, {"q": "17. Giochi pi√π spesso a:", "key_id": "Q17", "raw": "A", "options": {"A": "Giochi in cui devi muoverti", "B": "Giochi in cui devi pensare"}, "is_text": false, "error": null, "a": "Giochi in cui devi muoverti", "a_html": "Giochi in cui devi muoverti"}, {"q": "18. Preferisci:", "key_id": "Q18", "raw": "B", "options": {"A": "Giochi in cui devi muoverti", "B": "Giochi in cui devi pensare"}, "is_text": false, "error": null, "a": "Giochi in cui devi pensare", "a_html": "Giochi in cui devi pensare"}, {"q": "19. Preferisci giochi in cui:", "key_id": "Q19", "raw": "B", "options": {"A": "Risolvere enigmi", "B": "Scoprire cose", "C": "Aiutare gli altri", "D": "Collezionare premi/obiettivi", "E": "Sconfiggere gli altri"}, "is_text": false, "error": null, "a": "Scoprire cose", "a_html": "Scoprire cose"}, {"q": "20. Scrivi il nome dei 3 giochi a cui giochi pi√π spesso", "key_id": "Q20", "a": "UNO, MONOPOLY, ROBLOX", "a_html": "<strong>UNO, MONOPOLY, ROBLOX</strong>", "raw": "UNO, MONOPOLY, ROBLOX", "options": null, "is_text": true, "error": null}, {"q": "21. Cosa nel sangue √® giallo, liquido e ricco di nutrienti?", "key_id": "Q21", "raw": "C", "options": {"A": "Piastrina", "B": "Globulo rosso", "C": "Globulo bianco", "D": "Plasma"}, "is_text": false, "error": null, "a": "Globulo bianco", "a_html": "Globulo bianco"}, {"q": "22. Quali sono i gruppi sanguigni?", "key_id": "Q22", "raw": "B", "options": {"A": "A, B, AB, 0", "B": "A, B, C, D", "C": "Plasma, sangue e globuli rossi", "D": "X, Y, XY, XX"}, "is_text": false, "error": null, "a": "A, B, C, D", "a_html": "A, B, C, D"}, {"q": "23. Chi tra queste persone pu√≤ donare sangue?", "key_id": "Q23", "raw": "D", "options": {"A": "Luisa di 10 anni", "B": "Cristiano di 75 anni", "C": "Giovanna di 45 anni", "D": "Simone di 16 anni"}, "is_text": false, "error": null, "a": "Simone di 16 anni", "a_html": "Simone di 16 anni"}, {"q": "24. Quale gruppo sanguigno pu√≤ donare sangue a pi√π gruppi?", "key_id": "Q24", "raw": "C", "options": {"A": "AB", "B": "0 (Zero)", "C": "C", "D": "XY"}, "is_text": false, "error": null, "a": "C", "a_html": "C"}, {"q": "25. Cosa √® AVIS?", "key_id": "Q25", "raw": "A", "options": {"A": "Assoc. Vaccinati Italiani Sanitari", "B": "Assistenza Volontari Sangue", "C": "Assoc. Volontari Italiani Sangue", "D": "Assemblea Veri Ispiratori"}, "is_text": false, "error": null, "a": "Assoc. Vaccinati Italiani Sanitari", "a_html": "Assoc. Vaccinati Italiani Sanitari"}, {"q": "26. Chi sono i donatori di sangue?", "key_id": "Q26", "raw": "C", "options": {"A": "Scelte dagli ospedali periodicamente", "B": "Medici e infermieri curanti", "C": "Persone comuni volontarie", "D": "Persone comuni pagate"}, "is_text": false, "error": null, "a": "Persone comuni volontarie", "a_html": "Persone comuni volontarie"}, {"q": "27. Quando √® utilizzato il sangue donato?", "key_id": "Q27", "raw": "C", "options": {"A": "Solo operazioni molto difficili", "B": "Solo malattie del sangue", "C": "Solo emergenze al pronto soccorso", "D": "Emergenze, operazioni e terapie"}, "is_text": false, "error": null, "a": "Solo emergenze al pronto soccorso", "a_html": "Solo emergenze al pronto soccorso"}, {"q": "28. In questi ultimi giorni, quanto sei felice?", "key_id": "Q28", "raw": "0", "options": {"A": "‚òπÔ∏è Per niente felice", "B": "üòê Poco felice", "C": "üôÇ Abbastanza felice", "D": "üòÑ Molto felice"}, "is_text": false, "error": "no-answer", "a": "(nessuna risposta)", "a_html": "(nessuna risposta)"}, {"q": "29. Quanto sei soddisfatta/o della tua vita a scuola?", "key_id": "Q29", "raw": "D", "options": {"A": "‚òπÔ∏è Per niente soddisfatta/o", "B": "üòê Poco soddisfatta/o", "C": "üôÇ Abbastanza soddisfatta/o", "D": "üòÑ Molto soddisfatta/o"}, "is_text": false, "error": null, "a": "üòÑ Molto soddisfatta/o", "a_html": "üòÑ Molto soddisfatta/o"}, {"q": "30. Quanto sei contenta/o della tua vita a casa?", "key_id": "Q30", "raw": "D", "options": {"A": "‚òπÔ∏è Per niente contenta/o", "B": "üòê Poco contenta/o", "C": "üôÇ Abbastanza contenta/o", "D": "üòÑ Molto contenta/o"}, "is_text": false, "error": null, "a": "üòÑ Molto contenta/o", "a_html": "üòÑ Molto contenta/o"}, {"q": "31. Biglietti regalo (0-10)", "key_id": "Q31", "raw": "10", "options": null, "is_text": true, "error": null, "a": "10", "a_html": "<strong>10</strong>"}], "page_num": 1, "serenity_raw_data": {"Q10": "B", "Q11": "B", "Q28": "0", "Q29": "D", "Q30": "D", "Q31": "10"}, "game_raw_data": {"Q15": "C", "Q16": "B"}, "pdf_data": "JVBERi0xLjQKJZOMi54gUmVwb3J0TGFiIEdlbmVyYXRlZCBQREYgZG9jdW1lbnQgaHR0cDovL3d3dy5yZXBvcnRsYWIuY29tCjEgMCBvYmoKPDwKL0YxIDIgMCBSIC9GMiAzIDAgUiAvRjMgNCAwIFIgL0Y0IDUgMCBSCj4+CmVuZG9iagoyIDAgb2JqCjw8Ci9CYXNlRm9udCAvSGVsdmV0aWNhIC9FbmNvZGluZyAvV2luQW5zaUVuY29kaW5nIC9OYW1lIC9GMSAvU3VidHlwZSAvVHlwZTEgL1R5cGUgL0ZvbnQKPj4KZW5kb2JqCjMgMCBvYmoKPDwKL0Jhc2VGb250IC9IZWx2ZXRpY2EtQm9sZCAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyAvTmFtZSAvRjIgL1N1YnR5cGUgL1R5cGUxIC9UeXBlIC9Gb250Cj4+CmVuZG9iago0IDAgb2JqCjw8Ci9CYXNlRm9udCAvWmFwZkRpbmdiYXRzIC9OYW1lIC9GMyAvU3VidHlwZSAvVHlwZTEgL1R5cGUgL0ZvbnQKPj4KZW5kb2JqCjUgMCBvYmoKPDwKL0Jhc2VGb250IC9IZWx2ZXRpY2EtT2JsaXF1ZSAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyAvTmFtZSAvRjQgL1N1YnR5cGUgL1R5cGUxIC9UeXBlIC9Gb250Cj4+CmVuZG9iago2IDAgb2JqCjw8Ci9Db250ZW50cyAxMCAwIFIgL01lZGlhQm94IFsgMCAwIDU5NS4yNzU2IDg0MS44ODk4IF0gL1BhcmVudCA5IDAgUiAvUmVzb3VyY2VzIDw8Ci9Gb250IDEgMCBSIC9Qcm9jU2V0IFsgL1BERiAvVGV4dCAvSW1hZ2VCIC9JbWFnZUMgL0ltYWdlSSBdCj4+IC9Sb3RhdGUgMCAvVHJhbnMgPDwKCj4+IAogIC9UeXBlIC9QYWdlCj4+CmVuZG9iago3IDAgb2JqCjw8Ci9QYWdlTW9kZSAvVXNlTm9uZSAvUGFnZXMgOSAwIFIgL1R5cGUgL0NhdGFsb2cKPj4KZW5kb2JqCjggMCBvYmoKPDwKL0F1dGhvciAoXChhbm9ueW1vdXNcKSkgL0NyZWF0aW9uRGF0ZSAoRDoyMDI2MDIwNzE1MDY0OSswMScwMCcpIC9DcmVhdG9yIChcKHVuc3BlY2lmaWVkXCkpIC9LZXl3b3JkcyAoKSAvTW9kRGF0ZSAoRDoyMDI2MDIwNzE1MDY0OSswMScwMCcpIC9Qcm9kdWNlciAoUmVwb3J0TGFiIFBERiBMaWJyYXJ5IC0gd3d3LnJlcG9ydGxhYi5jb20pIAogIC9TdWJqZWN0IChcKHVuc3BlY2lmaWVkXCkpIC9UaXRsZSAoXChhbm9ueW1vdXNcKSkgL1RyYXBwZWQgL0ZhbHNlCj4+CmVuZG9iago5IDAgb2JqCjw8Ci9Db3VudCAxIC9LaWRzIFsgNiAwIFIgXSAvVHlwZSAvUGFnZXMKPj4KZW5kb2JqCjEwIDAgb2JqCjw8Ci9GaWx0ZXIgWyAvQVNDSUk4NURlY29kZSAvRmxhdGVEZWNvZGUgXSAvTGVuZ3RoIDI1NTkKPj4Kc3RyZWFtCkdhdUhOZ04oZTcmcTBMVWpOQFpoJzI+MTM4dCkoVV9aN2phQCVfaW9Gc0hqWy9CZEc3ZCYjLURNO1tcWVghQz9qRj5KViJAPkVcNVhPUEBsYmBkPUA2QTMsJ3JRZSlkVmQiRTpKY11NZl1gb3NCSkYuLHNeLTJAPEwzSkpGImYyTmVQZj8+NmQtVCguciowamhfQk9AWTtiOihCKCVASGQ2cS42SCozT2NRNltTVGRtcm04IjshdERYVS40SkQ0PDVHTiQvbjJXIlVVL1tTNFwwRU0nKGFPNS4lPj1MJGVvIz1CYmc9M0llXGlybypcOGdxQDpyZ1VNakkwJ188OiQyXSRbL2VwcWxVTl1hRl11XENGPCNULjdpdHUwZjJnSnVHKj5kLGwhMFtBJnFuYyEpQi9NbExwYix1Kjk9U01nKSdcODMhKGhGWFcuR081Y1I9cUZmM1M8cyk4WVJKIV1GXVsmY04oWTV1XGlRKHVqMlpYIWlfSTdZZVN0XDo2U2o6OF1NSCFEWiQsRV8mLzA8ZzpCYVs9SnRqZzpaXUU9MlI8X0t1V1VmaURaV0Bua3FqLGtrO1QrOWpSIS1zMlBwV3E+USYmTUElLnJBRnRzUTFkdVdPZ0VdKj40P1wnckhgU1MuUCwnU0A3ME1TR24/NFgyYC8zRV5pNFc/UjYwMWUpXnNII0dpXlNlcF1UOmgxUCI7IzEmO1taMitKJ1ApMnVWXWMwQm02L1JzZWpxY3Q4NTUmWiVdJEQqMCsiPVVdLDMkR3BUZCNsbGsyWVgrcWdSc1k0RVNxKnMlIyUtUz8ldCVAaWlUXUlyQkFvb1xJJ1xMU2A7bDNfVWs2XTIhKy1xZVxca14tbUBlRTs0MUA6KGA+WGsmMWpSZ245SS4tVzVQQlEqNlheLlw5WDRuU2MwZFglPj8sdCdwNmBgZmh0Nj48KnRKS0dBJ1BqQlQyTDhWVyJBRyshbWcuNF9dYzNlUyQiSlM+YXQqIl5uV0YoZVhuUiklc2NySnFZWkhcciVedFBVRzM6YWZEaSc4RC0uXTU9S2EzZDtySCoyMicsIilCL2lhXE1QVkw/aitxWk9PcTxiOy1SMT5eY2dRaHNkWlFGWjc+UCZeWFY1dGlrKG9CM20pXzZKOW9FNXBgdUJjJy1DMFBuIjA1JF5rSGEoYCRuQDlEWHI8MiEvJCwsIyZHQEhzWWhJZUw+OC8hOVMuPFgqbDUjKT1idVJ0U2VOUWlmRTBFYWpLbyIwc0IkUy51O1BZYXU3JmxPW0tucSUzQmI1XzJnTEYrMkQuX11BO2NlcnNMKT08NzJAYi1HVFM1XkFTRlNYMSkwVS89LDZcQzEqSidtUkBTZ1I+Jko1UCpGbjMiRF5GT0QxQyowTls3KytJLSw0SD5Ta1hqU29fWC9AcC5IJy5ebjhPIjBtJT0mXjwwTGdDTS85cEMhPChDWytqOyoyMjA9bEg8IWA4PF88JUEuM3BqM2BgYU1LVSpjXiptcD0iI0MwXkxiXy9GKkFOUk46dGg1U0QzVDkvVHNQJmdxWjFaOzJdLSEmbGZ1Ok5jR0NbZUlWMC1cVE47JkRIVGdcKWwzOkcxbExua0hZIVVkUmNjaGA+U2MhTU1PNSRkS2d0cEwlaStBRVZnOW5sUCVAQyZWRGlvREpYZWMhbDdjRiMpWVJGLTI8PyZmb18kOFJaJ2NVL18xJVlQbkciXUZsZUNPQkQ4KzdTLFs9OiplOmdpJmcwVyk6PmVRSVIqNWVYYlFdVi1NXDFFWEBaaSxcS15fbzhpKU5xRl1yQ1hrb1dMKzwpZ3BUOzMxZl9XbTJCQFNZaks1Ky1sSyZBaWRqSHRPMCxxNnFQSmAkT19cJ2BPc0NkI2Q8aDwxLCxQMzRIQFBQbyslT3MzKz9ROiRyPHFaREg9NVAlcW5oRjNeZDI9OVkvVUVoMGxbLlM8PlhxX0lTPTEsWElbaF0/b0xiLTpPWFksVl5gaUY7MlxGWy5POEZIYlY+MkhvISo4LiIxJTIxcDg1OUgwPUc2SjRaakxOcl9zW2tcN2ZFYWwkVmJMamNoI1EkR3VQYE1fYD81P24zb2xkVjVkWDshK2xNOHRxXC4oYyU+UDZCUDAvTVJlMDVaKmtKNW8ncCtwNF8uKjtIOTVfRkBsLGZyXVE1Q1hkISdhOzteOFk5IW8pOlQxT2UsUk4kVWRUX3Eza2AxPV5ORWUzOScmNEotPS0iVjIyXzRiQS8/WFBTTzxuXU4oJiNJRUgoSTEyQT5yVCZbWE5XYlNIN09MazU9YDhUVi1OZHBlSicrOCtHVzwhZmhEM2dyVzQsVD5Nci1EJipJX0YwbSI5PUQzVFVPaFFEMz1lb15IPyZSOlMscTtKKVdlUVBlVSxTYC1TMyYuXjRvQ3BOb3FgZ2ssYzRAITREQ1JPUHBlNjNeX1whc0hSXDs8bFtRMCVVPDEjdTlQRmRtMnMsZUo8WiY1W1FHcFkxVGBdWGA5Nm5hPkUwSihPMktpcCNjZXM3aisuTSFkJVEmI2QpbzNmYSo8XVhbJ2dEVXUtUWZfPHM0LipUYGc/cnJGV0EkWD5LU3VWNXRvQmtbVW5obTNPbzxQO0pIUilzYjdUWiJ1PGBobjhSSSg1WT8uZE8jKDFxNiheLjFBWnI8WG1ZUz9MbzkpUDQoaSYiZHRcJlFFQj4vOkUmQUVXVGxrN3ItK24mSGs7a2ZPWCo9RS5rXyFOW3M2UmZwb2FeP2VZbDVTIVw0OTBxZ2E5PD87UTxAUFYlTjZDSTEpODQjPlFsQjE7QTluKS5iJSotMCgzXFZpWk06PCZrX0JVSFAtJ2kwYmI6T3NBYms7LXIvKnA8cEZfVWpRY1c7Ji00OU5fU2s/LGJcIWU5SmQxUjdBOl1dcTM+bCxtKjNjI2dQZWZfI1g6Lj9qXmxINCFTPGFyKGxpVE85WHNCN3JNSCcyQ2A6Mmw4XCdSPHVtLU5cYC1tXGQtOFw3UkVOZiNGJiVlNEg1Tls1NDpSM1IqVkQsRyVgNHMxUEVVTXJkWT91YG0wWTkxMmxsM29mOU1RUm1VLGQ1dD9xNFdxIyZYSGw0cVVbTkE9QEBHJiElV2VPXG1USiY/KTNibVBPQXBsMF5bUmdEJGguNT1kKEFDNF1LWi05aCh1VjZKbDFUZE9pV20yIW9uPFgvODFMdEVKPEM3O1ZlTTZZZ0RrPFhBX0xxVUZvIlptTU1iXUNpS0ctazxFV1pGaGlRQiQoQlxEJURrKiY9YSJuZUIoKGpZXHFaLWo5Km8yWj1MOFEnKFZrWDo2RlInKls1YT5vMklzL3RFb2puaSdhYVFML0FdOnBoSUhoTjNZLVsjVmcyInBIXTJlS2o3UXM/QExFcigxZGZeVEY+N10kWSYsVFB0ITx+PmVuZHN0cmVhbQplbmRvYmoKeHJlZgowIDExCjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDA3MyAwMDAwMCBuIAowMDAwMDAwMTM0IDAwMDAwIG4gCjAwMDAwMDAyNDEgMDAwMDAgbiAKMDAwMDAwMDM1MyAwMDAwMCBuIAowMDAwMDAwNDM2IDAwMDAwIG4gCjAwMDAwMDA1NTEgMDAwMDAgbiAKMDAwMDAwMDc1NSAwMDAwMCBuIAowMDAwMDAwODIzIDAwMDAwIG4gCjAwMDAwMDExMDYgMDAwMDAgbiAKMDAwMDAwMTE2NSAwMDAwMCBuIAp0cmFpbGVyCjw8Ci9JRCAKWzw0OGI3NDc0MWM4MDcxNjZlODU1YmZlOGVjNjcyZjQyZD48NDhiNzQ3NDFjODA3MTY2ZTg1NWJmZThlYzY3MmY0MmQ+XQolIFJlcG9ydExhYiBnZW5lcmF0ZWQgUERGIGRvY3VtZW50IC0tIGRpZ2VzdCAoaHR0cDovL3d3dy5yZXBvcnRsYWIuY29tKQoKL0luZm8gOCAwIFIKL1Jvb3QgNyAwIFIKL1NpemUgMTEKPj4Kc3RhcnR4cmVmCjM4MTYKJSVFT0YK"}];
const globalStats = {"Q01": {"B": 100.0}, "Q02": {"B": 50.0, "A": 50.0}, "Q03": {"B": 100.0}, "Q04": {"A": 100.0}, "Q05": {"B": 50.0, "C": 50.0}, "Q06": {"A": 50.0, "B": 50.0}, "Q07": {"C": 100.0}, "Q08": {"C": 100.0}, "Q09": {"A": 100.0}, "Q10": {"B": 50.0, "A": 50.0}, "Q11": {"B": 50.0, "A": 50.0}, "Q12": {"A": 50.0, "C": 50.0}, "Q13": {"C": 100.0}, "Q14": {"A": 50.0, "C": 50.0}, "Q15": {"C": 50.0, "D": 50.0}, "Q16": {"B": 100.0}, "Q17": {"A": 100.0}, "Q18": {"B": 50.0, "A": 50.0}, "Q19": {"B": 100.0, "A": 50.0}, "Q21": {"C": 100.0}, "Q22": {"B": 50.0, "C": 50.0}, "Q23": {"D": 100.0}, "Q24": {"C": 50.0, "A": 50.0}, "Q25": {"A": 50.0, "B": 50.0}, "Q26": {"C": 100.0}, "Q27": {"C": 50.0, "D": 50.0}, "Q29": {"D": 100.0}, "Q30": {"D": 100.0}, "Q28": {"D": 50.0}, "Q31": {"average": 10.0}};
const allGamesList = [{"name": "Animal Crossing", "count": 1}, {"name": "Just Dance", "count": 1}, {"name": "Mario Kart", "count": 1}, {"name": "Monopoly", "count": 1}, {"name": "Roblox", "count": 1}, {"name": "Uno", "count": 1}];
const GITHUB_FRAME_URL = "https://sebastiano-mazzarisi.github.io/Test/Frame.pdf";

let currentIndex = -1;
let currentItem = null;
document.body.tabIndex = -1;
document.body.focus();

function getScrollElement() {
    const isDesktop = window.innerWidth >= 1024;
    return (currentIndex === -1 && isDesktop) ? document.getElementById('menu') : document.querySelector('.container');
}

function calculateGameBreakdown(rawData) {
    if (!rawData) return null;
    const breakdown = [];
    let totalPoints = 0;
    
    // Pesi per Q15 e Q16
    const weights = {'Q15': 50, 'Q16': 50};
    const questionsText = {
        'Q15': '15. Quanto spesso giochi ai giochi da tavolo o di carte?',
        'Q16': '16. Quanto spesso giochi su cellulare, tablet, computer o console?'
    };
    
    // Mappatura frequenza ‚Üí punti
    const frequencyPoints = {
        'A': 50,     // Tutti i giorni
        'B': 37.5,   // Almeno una volta a settimana
        'C': 25,     // Almeno una volta al mese
        'D': 12.5,   // Quasi mai
        'E': 0       // Mai
    };
    
    for (const key of ['Q15', 'Q16']) {
        const rawValue = (rawData[key] || '').trim().toUpperCase();
        const maxPoints = weights[key];
        const midPoints = 25; // Media neutra
        let points = 0, interpretation = '', displayValue = rawValue;
        
        if (['0', '', '*', 'NAN'].includes(rawValue)) {
            points = midPoints;
            interpretation = 'Mancante (media)';
            displayValue = '-';
        } else if (frequencyPoints[rawValue] !== undefined) {
            points = frequencyPoints[rawValue];
            const labels = {
                'A': 'Tutti i giorni',
                'B': 'Almeno una volta a settimana',
                'C': 'Almeno una volta al mese',
                'D': 'Quasi mai',
                'E': 'Mai'
            };
            interpretation = labels[rawValue] || rawValue;
        } else {
            points = midPoints;
            interpretation = 'Valore non valido (media)';
        }
        
        totalPoints += points;
        breakdown.push({
            question: questionsText[key],
            value: displayValue,
            interpretation: interpretation,
            points: points,
            maxPoints: maxPoints
        });
    }
    
    const totalFinal = Math.min(totalPoints, 100.0);
    const totalRounded = Math.ceil(totalFinal);
    
    return { breakdown: breakdown, total: totalFinal, totalRounded: totalRounded };
}

function calculateSerenityBreakdown(rawData) {
    if (!rawData) return null;
    const breakdown = [];
    let totalPoints = 0;
    const weights = {'Q10': 20, 'Q11': 20, 'Q28': 15, 'Q29': 15, 'Q30': 15, 'Q31': 15};
    const questionsText = {
        'Q10': '10. Cosa pensi della donazione?', 'Q11': '11. Come ti senti pensando alla donazione?',
        'Q28': '28. Quanto sei felice?', 'Q29': '29. Soddisfazione vita a scuola?',
        'Q30': '30. Contentezza vita a casa?', 'Q31': '31. Biglietti regalo (0-10)'
    };
    
    for (const key of ['Q10', 'Q11', 'Q28', 'Q29', 'Q30', 'Q31']) {
        const rawValue = (rawData[key] || '').trim().toUpperCase();
        const maxPoints = weights[key];
        const midPoints = maxPoints / 2;
        let points = 0, interpretation = '', displayValue = rawValue;
        
        if (['0', '', '*', 'NAN'].includes(rawValue)) {
            points = midPoints; interpretation = 'Mancante (media)'; displayValue = '-';
        } else if (key === 'Q10') {
            if (rawValue === 'A') { points = maxPoints; interpretation = 'Positivo (√à bella)'; }
            else if (rawValue === 'C') { points = midPoints; interpretation = 'Incerto (Non sicuro)'; }
            else if (rawValue === 'B') { points = 0; interpretation = 'Negativo (√à brutta)'; }
        } else if (key === 'Q11') {
            if (rawValue === 'A') { points = maxPoints; interpretation = 'Positivo (Felice)'; }
            else if (rawValue === 'C') { points = midPoints; interpretation = 'Incerto (Non so)'; }
            else if (rawValue === 'B') { points = 0; interpretation = 'Negativo (Triste)'; }
        } else if (['Q28', 'Q29', 'Q30'].includes(key)) {
            if (['C', 'D'].includes(rawValue)) { points = maxPoints; interpretation = 'Positivo (C/D)'; }
            else if (['A', 'B'].includes(rawValue)) { points = 0; interpretation = 'Negativo (A/B)'; }
        } else if (key === 'Q31') {
            try {
                const numeri = rawValue.replace(/\D/g, '');
                if (numeri) {
                    const numBiglietti = parseInt(numeri);
                    points = Math.min((numBiglietti / 10) * maxPoints, maxPoints);
                    interpretation = `Altruismo (${numBiglietti} biglietti)`;
                } else { points = midPoints; interpretation = 'Non numerico (media)'; }
            } catch { points = 0; interpretation = 'Errore lettura'; }
        }
        totalPoints += points;
        breakdown.push({question: questionsText[key], value: displayValue, interpretation: interpretation, points: points, maxPoints: maxPoints});
    }
    return {breakdown: breakdown, total: Math.min(totalPoints, 100), totalRounded: Math.ceil(Math.min(totalPoints, 100))};
}

function showSerenityBreakdown(item) {
    if (!item.serenity_raw_data) { alert('Dati di calcolo non disponibili.'); return; }
    const result = calculateSerenityBreakdown(item.serenity_raw_data);
    if (!result) return;
    
    const answerMap = {
        'Q10': { 'A': '√à una cosa bella', 'B': '√à una cosa brutta', 'C': 'Non ne sono sicuro/a' },
        'Q11': { 'A': 'Felice', 'B': 'Triste', 'C': 'Non lo so' },
        'Q28': { 'A': '‚òπÔ∏è Per niente felice', 'B': 'üòê Poco felice', 'C': 'üôÇ Abbastanza felice', 'D': 'üòÑ molto felice' },
        'Q29': { 'A': '‚òπÔ∏è Per niente soddisfatta/o', 'B': 'üòê Poco soddisfatta/o', 'C': 'üôÇ Abbastanza soddisfatta/o', 'D': 'üòÑ Molto soddisfatta/o' },
        'Q30': { 'A': '‚òπÔ∏è Per niente contenta/o', 'B': 'üòê Poco contenta/o', 'C': 'üôÇ Abbastanza contenta/o', 'D': 'üòÑ Molto contenta/o' },
        'Q31': {}
    };
    
    let html = '<table class="serenity-breakdown-table"><thead><tr><th>Domanda e risposta</th><th style="width:120px; text-align:right;">Punti</th></tr></thead><tbody>';
    result.breakdown.forEach((item, index) => {
        const qKey = ['Q10', 'Q11', 'Q28', 'Q29', 'Q30', 'Q31'][index];
        let displayAnswer = '';
        if (item.value === '-' || item.value === '') displayAnswer = '(nessuna risposta)';
        else if (qKey === 'Q31') displayAnswer = `${item.value.replace(/\D/g, '')} biglietti`;
        else displayAnswer = answerMap[qKey][item.value] || item.value;
        
        html += `<tr><td><div class="breakdown-question">${item.question}</div><div class="breakdown-answer">${displayAnswer}</div></td><td class="breakdown-points">${item.points.toFixed(1)} / ${item.maxPoints}</td></tr>`;
    });
    html += `</tbody></table><div class="breakdown-total">TOTALE: ${result.total.toFixed(2)} ‚Üí Arrotondato: ${result.totalRounded}%</div>`;
    document.getElementById('serenityModalContent').innerHTML = html;
    document.getElementById('serenityModal').style.display = 'flex';
    document.body.classList.add('modal-open');
}

function showGameBreakdown(item) {
    if (!item.game_raw_data) { alert('Dati di calcolo non disponibili.'); return; }
    const result = calculateGameBreakdown(item.game_raw_data);
    if (!result) return;
    
    const answerMap = {
        'Q15': {
            'A': 'Tutti i giorni',
            'B': 'Almeno una volta a settimana',
            'C': 'Almeno una volta al mese',
            'D': 'Quasi mai',
            'E': 'Mai'
        },
        'Q16': {
            'A': 'Tutti i giorni',
            'B': 'Almeno una volta a settimana',
            'C': 'Almeno una volta al mese',
            'D': 'Quasi mai',
            'E': 'Mai'
        }
    };
    
    let html = '<table class="serenity-breakdown-table"><thead><tr><th>Domanda e risposta</th><th style="width:120px; text-align:right;">Punti</th></tr></thead><tbody>';
    result.breakdown.forEach((item, index) => {
        const qKey = ['Q15', 'Q16'][index];
        let displayAnswer = '';
        if (item.value === '-' || item.value === '') displayAnswer = '(nessuna risposta)';
        else displayAnswer = answerMap[qKey][item.value] || item.value;
        
        html += `<tr><td><div class="breakdown-question">${item.question}</div><div class="breakdown-answer">${displayAnswer}</div></td><td class="breakdown-points">${item.points.toFixed(1)} / ${item.maxPoints}</td></tr>`;
    });
    html += `</tbody></table><div class="breakdown-total">TOTALE: ${result.total.toFixed(2)} ‚Üí Arrotondato: ${result.totalRounded}%</div>`;
    document.getElementById('gameModalContent').innerHTML = html;
    document.getElementById('gameModal').style.display = 'flex';
    document.body.classList.add('modal-open');
}

function renderMenu() {
    const menu = document.getElementById('menu');
    menu.innerHTML = '';
    document.getElementById('title').innerText = `Questionari AVIS (${allData.length})`;
    allData.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'menu-item';
        
        // Crea badge separati per serenit√† e gioco
        let badgesHtml = '';
        if (item.serenity_opt || item.game_opt) {
            badgesHtml = '<span class="opt-badges">';
            if (item.serenity_opt && item.game_opt) {
                // Entrambi presenti: formato (üòä 87% - üèÄ 63%)
                badgesHtml += `<span class="opt-badge" onclick="event.stopPropagation(); showSerenityBreakdown(allData[${idx}])">${item.serenity_opt}</span> - <span class="opt-badge" onclick="event.stopPropagation(); showGameBreakdown(allData[${idx}])">${item.game_opt}</span>`;
            } else if (item.serenity_opt) {
                // Solo serenit√†
                badgesHtml += `<span class="opt-badge" onclick="event.stopPropagation(); showSerenityBreakdown(allData[${idx}])">${item.serenity_opt}</span>`;
            } else if (item.game_opt) {
                // Solo gioco
                badgesHtml += `<span class="opt-badge" onclick="event.stopPropagation(); showGameBreakdown(allData[${idx}])">${item.game_opt}</span>`;
            }
            badgesHtml += '</span>';
        }
        
        div.innerHTML = `<div class="menu-item-left"><span class="menu-item-id">${item.id}</span><span class="menu-item-sex">${item.sex}</span></div>&nbsp;&nbsp;&nbsp;${badgesHtml}`;
        div.addEventListener('click', (e) => { if (!e.target.classList.contains('opt-badge')) showDetail(idx); });
        menu.appendChild(div);
    });
    const spacer = document.createElement('div');
    spacer.style.height = '100px'; spacer.style.gridColumn = '1 / -1';
    menu.appendChild(spacer);
}

function showDetail(idx) {
    currentIndex = idx;
    currentItem = allData[idx];
    let titleHtml = currentItem.id;
    
    // Aggiungi badge separati per serenit√† e gioco
    if (currentItem.serenity_opt || currentItem.game_opt) {
        titleHtml += ' ‚Ä¢ ';
        if (currentItem.serenity_opt && currentItem.game_opt) {
            // Entrambi: (üòä 87% - üèÄ 63%)
            titleHtml += `<span class="opt-badge" style="cursor:pointer; display:inline-block; vertical-align:middle;" onclick="showSerenityBreakdown(currentItem)">${currentItem.serenity_opt}</span> - <span class="opt-badge" style="cursor:pointer; display:inline-block; vertical-align:middle;" onclick="showGameBreakdown(currentItem)">${currentItem.game_opt}</span>`;
        } else if (currentItem.serenity_opt) {
            // Solo serenit√†
            titleHtml += `<span class="opt-badge" style="cursor:pointer; display:inline-block; vertical-align:middle;" onclick="showSerenityBreakdown(currentItem)">${currentItem.serenity_opt}</span>`;
        } else if (currentItem.game_opt) {
            // Solo gioco
            titleHtml += `<span class="opt-badge" style="cursor:pointer; display:inline-block; vertical-align:middle;" onclick="showGameBreakdown(currentItem)">${currentItem.game_opt}</span>`;
        }
    }
    
    document.getElementById('title').innerHTML = titleHtml;
    document.querySelector('.header-content').classList.add('detail-mode');
    ['prevBtn', 'homeBtn', 'viewBtn', 'printBtn', 'nextBtn'].forEach(id => document.getElementById(id).style.display = 'flex');
    document.getElementById('menu').style.display = 'none';
    const detail = document.getElementById('detail');
    detail.className = 'detail active';
    
    // --- DISTRIBUZIONE SU 4 COLONNE LOGICHE (Il CSS gestir√† 1, 2 o 4 visive) ---
    const cols = [[], [], [], []]; 
    currentItem.answers.forEach((ans, ansIdx) => {
        const num = parseInt(ans.key_id.replace(/\D/g, ''));
        let colIdx = 3; // Default ultima colonna per item non numerici
        if (!isNaN(num)) {
            if (num <= 9) colIdx = 0;        
            else if (num <= 18) colIdx = 1;  
            else if (num <= 26) colIdx = 2;  
            else colIdx = 3;                 
        }
        
        // Classi speciali per cornici colorate
        let specialClass = '';
        if (['Q03-T', 'Q20', 'Q31'].includes(ans.key_id)) {
            specialClass = 'text-field';  // Verde per campi a risposta libera
        } else if (ans.key_id === 'Q19') {
            specialClass = 'multi-choice';  // Giallo per risposta multipla Q19
        }
        
        const errorClass = ans.error ? ans.error : '';
        const allClasses = [errorClass, specialClass].filter(c => c).join(' ');
        const answerText = ans.a_html || ans.a;
        const itemHtml = `<div class="qa-item ${allClasses}" onclick="openQuestionModal(${ansIdx})"><div class="qa-question" title="${ans.q}">${ans.q}</div><div class="qa-answer">${answerText}</div></div>`;
        cols[colIdx].push(itemHtml);
    });
    
    let html = '<div class="layout-columns">';
    cols.forEach(colItems => { html += '<div class="col-group">' + colItems.join('') + '</div>'; });
    html += '</div>';
    detail.innerHTML = html;
}

function openQuestionModal(ansIdx) {
    const ans = currentItem.answers[ansIdx];
    document.getElementById('qModalTitle').innerText = ans.q;
    const container = document.getElementById('qModalContent');
    let content = '';
    if (ans.options) {
        const sortedKeys = Object.keys(ans.options).sort();
        const stats = globalStats[ans.key_id] || {};
        sortedKeys.forEach((key) => {
            const text = ans.options[key];
            let isSelected = ans.raw && ans.raw.includes(key);
            const checkbox = isSelected ? '‚òë' : '‚òê';
            const percent = stats[key] || 0;
            const barColor = isSelected ? '#28a745' : '#c9a000';
            const selectedClass = isSelected ? 'selected' : '';
            content += `<div class="option-wrapper"><div class="option-row ${selectedClass}"><span><strong>${checkbox}</strong> ${text}</span></div><div class="stat-bar-container"><div class="stat-bar" style="width: ${percent}%; background-color: ${barColor};"></div><span class="stat-text">${percent}%</span></div></div>`;
        });
    } else {
        content += `<div style="background:#f9f9f9; padding:15px; border-radius:8px; font-style:italic;">${ans.a || '(Nessuna risposta)'}</div>`;
        if (ans.key_id === 'Q31') {
             const avg = globalStats['Q31'] ? globalStats['Q31'].average : 0;
             content += `<div style="margin-top:15px; font-weight:bold; color:#667eea; text-align:center;">üìä Media voti: ${avg} / 10</div>`;
        }
        if (ans.key_id === 'Q20') {
            const gamesAlphabetic = [...allGamesList].sort((a, b) => a.name.localeCompare(b.name));
            const gamesByFrequency = [...allGamesList].sort((a, b) => b.count - a.count);
            content += '<div class="games-columns"><div class="games-column"><h3>üìñ Alfabetico</h3><ul>';
            gamesAlphabetic.forEach(game => { content += `<li><span class="game-name">${game.name}</span><span class="game-count">${game.count}</span></li>`; });
            content += '</ul></div><div class="games-column"><h3>üî• Frequenza</h3><ul>';
            gamesByFrequency.forEach(game => { content += `<li><span class="game-name">${game.name}</span><span class="game-count">${game.count}</span></li>`; });
            content += '</ul></div></div>';
        }
    }
    container.innerHTML = content;
    document.getElementById('questionModal').style.display = 'flex';
    document.body.classList.add('modal-open');
}

function closeModal(id) {
    document.getElementById(id).style.display = 'none';
    document.body.classList.remove('modal-open');
}

function goBack() {
    currentIndex = -1; currentItem = null;
    document.getElementById('title').innerText = 'Questionari AVIS';
    document.querySelector('.header-content').classList.remove('detail-mode');
    ['prevBtn', 'homeBtn', 'viewBtn', 'printBtn', 'nextBtn'].forEach(id => document.getElementById(id).style.display = 'none');
    document.getElementById('menu').style.display = 'flex';
    document.getElementById('detail').className = 'detail';
    document.getElementById('menu').style.display = ''; 
    document.body.focus();
}

function navigate(direction) {
    const max = allData.length - 1;
    if (max < 0) return;
    let newIdx = currentIndex + direction;
    if (newIdx < 0) newIdx = 0; if (newIdx > max) newIdx = max;
    showDetail(newIdx);
}

function viewPDF() {
    const item = allData[currentIndex];
    window.open(GITHUB_FRAME_URL + "#page=" + item.page_num, '_blank');
}

function printPDF() {
    const item = allData[currentIndex];
    if (!item.pdf_data) { alert('PDF non disponibile.'); return; }
    const byteCharacters = atob(item.pdf_data);
    const byteNumbers = new Array(byteCharacters.length);
    for (let i = 0; i < byteCharacters.length; i++) { byteNumbers[i] = byteCharacters.charCodeAt(i); }
    const byteArray = new Uint8Array(byteNumbers);
    const blob = new Blob([byteArray], { type: 'application/pdf' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `Report_${item.id}.pdf`;
    document.body.appendChild(a); a.click(); document.body.removeChild(a); window.URL.revokeObjectURL(url);
}

let touchStartY = 0;
document.addEventListener('touchstart', e => touchStartY = e.changedTouches[0].screenY, {passive: true});
document.addEventListener('touchend', e => {
    if (document.body.classList.contains('modal-open')) return;
    const swipeDistance = e.changedTouches[0].screenY - touchStartY;
    if (swipeDistance > 150 && window.scrollY === 0) {
        document.getElementById('loadingOverlay').style.display = 'flex';
        setTimeout(() => window.location.reload(), 500);
    }
}, {passive: true});

document.addEventListener('keydown', e => {
    if (e.key === 'Escape') { 
        if (document.getElementById('questionModal').style.display === 'flex') { closeModal('questionModal'); return; }
        if (document.getElementById('serenityModal').style.display === 'flex') { closeModal('serenityModal'); return; }
        if (document.getElementById('gameModal').style.display === 'flex') { closeModal('gameModal'); return; }
        if (currentIndex >= 0) goBack();
    }
    const scrollAmount = 100;
    if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        const scrollElement = getScrollElement();
        if (scrollElement) scrollElement.scrollTop += (e.key === 'ArrowDown' ? scrollAmount : -scrollAmount);
    }
    if (currentIndex >= 0) {
        if (e.key === 'ArrowRight') navigate(1);
        if (e.key === 'ArrowLeft') navigate(-1);
    }
});

renderMenu();
</script>
</body>
</html>
    