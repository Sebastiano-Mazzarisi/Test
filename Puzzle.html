<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Puzzle">
<link rel="apple-touch-icon" href="https://sebastiano-mazzarisi.github.io/Test/Puzzle.png">
<link rel="icon" type="image/png" href="https://sebastiano-mazzarisi.github.io/Test/Puzzle.png">
<meta name="theme-color" content="#2563eb">
<title>Puzzle by Mazzarisi</title>
<style>
:root{
  --bg:#f9fafb;--panel:#fff;--bordo:#b3d4fc;
  --tile:#e6f0ff;--tile-at:#e5e7eb;--tile-empty:#ffedd5;
  --tile-border:#d1d5db;--shadow:0 6px 20px rgba(0,0,0,.08);
  --radius:18px;--tile-radius:12px;--gap:4px;
  --tile-font:calc(1.8vw + 12px);
  --panel-yellow:#fff9db;
  --btn-bg:#f8f8f8;--btn-border:#d7d7d7;
  --btn-text:#333;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);font-family:"Poppins",system-ui,sans-serif;
display:flex;flex-direction:column;align-items:center;justify-content:center;
min-height:100dvh;color:#1f2937;-webkit-user-select:none;user-select:none;
touch-action:manipulation;}
.app{width:95vw;max-width:520px;background:var(--panel);
border-radius:var(--radius);box-shadow:var(--shadow);
padding:18px;text-align:center;}
.title{font-size:16px;margin-bottom:10px;font-style:italic;font-weight:400;
color:#374151;user-select:none;}
.board-bg{
  background:var(--panel-yellow);
  border-radius:22px;
  padding:16px;
  display:inline-block;
  box-shadow:inset 0 0 8px rgba(0,0,0,0.05);
  margin-bottom:8px;
}
.board-wrap{border:8px solid var(--bordo);border-radius:var(--radius);
padding:10px;background:var(--panel);
display:inline-block;transition:border .3s ease, border-color .2s ease;}
.board{display:grid;gap:var(--gap);justify-content:center;align-content:center;
margin:auto;transition:grid-template-columns .2s ease;}
.tile{aspect-ratio:1/1;width:calc(19vw);max-width:65px;display:grid;
place-items:center;border-radius:var(--tile-radius);
font-weight:700;font-size:var(--tile-font);
user-select:none;border:1px solid var(--tile-border);
transition:transform .1s;}
.tile.letter{background:var(--tile);color:#0f172a;}
.tile.at{background:var(--tile-at);color:transparent;}
.tile.empty{background:var(--tile-empty);border-style:dashed;color:#fb923c;}
.tile.clickable:active{transform:scale(.96);}
.controls{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-top:8px;}
button{
  border:1px solid var(--btn-border);
  background:var(--btn-bg);
  color:var(--btn-text);
  padding:11px 12px;
  min-width:135px;       /* +50% */
  border-radius:14px;    /* +40% */
  cursor:pointer;
  transition:.15s;
  box-shadow:0 3px 8px rgba(0,0,0,0.06);
  font-weight:600;
  font-size:22px;        /* +50% */
}
button:hover{background:#ededed;}
button:active{transform:scale(.96);}
button.primary{outline:2px solid #a7c3ff;}
@keyframes frameflash{
  0%{border-color:#3b82f6;}
  20%{border-color:#ef4444;}
  40%{border-color:#facc15;}
  60%{border-color:#22c55e;}
  80%{border-color:#06b6d4;}
  100%{border-color:#3b82f6;}
}
.flash-border{animation:frameflash 0.8s linear 5;}
.dialog-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:none;
justify-content:center;align-items:center;z-index:999;padding:16px;}
.dialog{background:#fff;border-radius:12px;padding:16px;width:100%;max-width:340px;
text-align:center;box-shadow:0 6px 25px rgba(0,0,0,0.3);}
.dialog .label{font-size:14px;color:#374151;margin-bottom:8px;}
.dialog input{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:8px;
font-size:17px;outline:none;}
.dialog .btns{display:flex;justify-content:center;gap:10px;margin-top:10px;}
.dialog button{margin:0;padding:8px 16px;border-radius:8px;font-weight:600;}
.dialog .ok{background:#2563eb;color:#fff;border:none;}
.dialog .cancel{background:#f3f4f6;border:1px solid #ddd;}
</style>
</head>
<body>
<div class="app">
  <div class="title">Puzzle by Mazzarisi</div>
  <div class="board-bg">
    <div class="board-wrap"><div class="board"></div></div>
  </div>

  <div class="controls">
    <button id="shuffle">Mescola</button>
    <button id="solve">Soluzione</button>
  </div>

  <div class="controls">
    <button id="next" class="primary">Prossimo</button>
    <button id="btnFacile" style="display:none;">Facile</button>
    <button id="btnDifficile">Difficile</button>
  </div>

  <div class="controls">
    <button id="btnTesto" style="display:none;">Testo</button>
    <button id="btnNumeri">Numeri</button>
    <button id="btnScrivi">Scrivi</button>
  </div>
</div>

<div class="dialog-overlay">
  <div class="dialog">
    <div class="label">Frase da ordinare:</div>
    <input type="text" id="frase" placeholder="scrivi qui...">
    <div class="btns">
      <button class="ok" id="okBtn">OK</button>
      <button class="cancel" id="cancelBtn">Esci</button>
    </div>
  </div>
</div>

<script id="puzzle-data" type="application/json">{"parole": ["LEFEMINE FRANCESCO", "GRILLETTI TERESA", "TRIVISANI ANNA", "MAZZARISI TERESA", "PRICCI ASIA", "MAZZARISI ONOFRIO", "BIANCO ROSA", "PRICCI GIOVANNI", "PRICCI MARIA ANTONIETTA", "PRICCI ANGELA", "PRICCI GIUSEPPE", "LORUSSO ALESSANDRO", "MAZZARISI NINO", "ROTONDI NICOLETTA", "CHIARAPPA CRISTIANO", "LEFEMINE DOMENICO", "PRICCI GILDA", "LORUSSO BENNY", "LORUSSO ALICE", "MAZZARISI MARIA GRAZIA", "PRICCI MARICA", "CHIARAPPA SAVERIO", "DALENA RICCARDO", "LEFEMINE FLAVIA", "PRICCI LUIGI", "LORUSSO ONOFRIO", "PRICCI TIZIANA", "LORUSSO NINA", "LEPORE GENNY", "PRICCI VANNA", "ROTONDI GIANNI", "CHIARAPPA MARTINO", "LORUSSO CINZIA"], "mappa": {"1": {"totale_pezzi": 2, "righe": 2, "colonne": 2, "riempimento_at": 2, "vuoti_hash": 1}, "2": {"totale_pezzi": 3, "righe": 2, "colonne": 2, "riempimento_at": 1, "vuoti_hash": 1}, "3": {"totale_pezzi": 4, "righe": 2, "colonne": 2, "riempimento_at": 0, "vuoti_hash": 1}, "4": {"totale_pezzi": 5, "righe": 2, "colonne": 3, "riempimento_at": 1, "vuoti_hash": 1}, "5": {"totale_pezzi": 6, "righe": 2, "colonne": 3, "riempimento_at": 0, "vuoti_hash": 1}, "6": {"totale_pezzi": 7, "righe": 3, "colonne": 3, "riempimento_at": 2, "vuoti_hash": 1}, "7": {"totale_pezzi": 8, "righe": 3, "colonne": 3, "riempimento_at": 1, "vuoti_hash": 1}, "8": {"totale_pezzi": 9, "righe": 3, "colonne": 3, "riempimento_at": 0, "vuoti_hash": 1}, "9": {"totale_pezzi": 10, "righe": 3, "colonne": 4, "riempimento_at": 2, "vuoti_hash": 1}, "10": {"totale_pezzi": 11, "righe": 3, "colonne": 4, "riempimento_at": 1, "vuoti_hash": 1}, "11": {"totale_pezzi": 12, "righe": 3, "colonne": 4, "riempimento_at": 0, "vuoti_hash": 1}, "12": {"totale_pezzi": 13, "righe": 4, "colonne": 4, "riempimento_at": 3, "vuoti_hash": 1}, "13": {"totale_pezzi": 14, "righe": 4, "colonne": 4, "riempimento_at": 2, "vuoti_hash": 1}, "14": {"totale_pezzi": 15, "righe": 4, "colonne": 4, "riempimento_at": 1, "vuoti_hash": 1}, "15": {"totale_pezzi": 16, "righe": 4, "colonne": 4, "riempimento_at": 0, "vuoti_hash": 1}, "16": {"totale_pezzi": 17, "righe": 4, "colonne": 5, "riempimento_at": 3, "vuoti_hash": 1}, "17": {"totale_pezzi": 18, "righe": 4, "colonne": 5, "riempimento_at": 2, "vuoti_hash": 1}, "18": {"totale_pezzi": 19, "righe": 4, "colonne": 5, "riempimento_at": 1, "vuoti_hash": 1}, "19": {"totale_pezzi": 20, "righe": 4, "colonne": 5, "riempimento_at": 0, "vuoti_hash": 1}, "20": {"totale_pezzi": 21, "righe": 5, "colonne": 5, "riempimento_at": 4, "vuoti_hash": 1}, "21": {"totale_pezzi": 22, "righe": 5, "colonne": 5, "riempimento_at": 3, "vuoti_hash": 1}, "22": {"totale_pezzi": 23, "righe": 5, "colonne": 5, "riempimento_at": 2, "vuoti_hash": 1}, "23": {"totale_pezzi": 24, "righe": 5, "colonne": 5, "riempimento_at": 1, "vuoti_hash": 1}, "24": {"totale_pezzi": 25, "righe": 5, "colonne": 5, "riempimento_at": 0, "vuoti_hash": 1}, "25": {"totale_pezzi": 26, "righe": 5, "colonne": 6, "riempimento_at": 4, "vuoti_hash": 1}, "26": {"totale_pezzi": 27, "righe": 5, "colonne": 6, "riempimento_at": 3, "vuoti_hash": 1}, "27": {"totale_pezzi": 28, "righe": 5, "colonne": 6, "riempimento_at": 2, "vuoti_hash": 1}, "28": {"totale_pezzi": 29, "righe": 5, "colonne": 6, "riempimento_at": 1, "vuoti_hash": 1}, "29": {"totale_pezzi": 30, "righe": 5, "colonne": 6, "riempimento_at": 0, "vuoti_hash": 1}, "30": {"totale_pezzi": 31, "righe": 6, "colonne": 6, "riempimento_at": 5, "vuoti_hash": 1}, "31": {"totale_pezzi": 32, "righe": 6, "colonne": 6, "riempimento_at": 4, "vuoti_hash": 1}, "32": {"totale_pezzi": 33, "righe": 6, "colonne": 6, "riempimento_at": 3, "vuoti_hash": 1}, "33": {"totale_pezzi": 34, "righe": 6, "colonne": 6, "riempimento_at": 2, "vuoti_hash": 1}, "34": {"totale_pezzi": 35, "righe": 6, "colonne": 6, "riempimento_at": 1, "vuoti_hash": 1}, "35": {"totale_pezzi": 36, "righe": 6, "colonne": 6, "riempimento_at": 0, "vuoti_hash": 1}, "36": {"totale_pezzi": 37, "righe": 6, "colonne": 7, "riempimento_at": 5, "vuoti_hash": 1}, "37": {"totale_pezzi": 38, "righe": 6, "colonne": 7, "riempimento_at": 4, "vuoti_hash": 1}, "38": {"totale_pezzi": 39, "righe": 6, "colonne": 7, "riempimento_at": 3, "vuoti_hash": 1}, "39": {"totale_pezzi": 40, "righe": 6, "colonne": 7, "riempimento_at": 2, "vuoti_hash": 1}, "40": {"totale_pezzi": 41, "righe": 6, "colonne": 7, "riempimento_at": 1, "vuoti_hash": 1}, "41": {"totale_pezzi": 42, "righe": 6, "colonne": 7, "riempimento_at": 0, "vuoti_hash": 1}, "42": {"totale_pezzi": 43, "righe": 7, "colonne": 7, "riempimento_at": 6, "vuoti_hash": 1}, "43": {"totale_pezzi": 44, "righe": 7, "colonne": 7, "riempimento_at": 5, "vuoti_hash": 1}, "44": {"totale_pezzi": 45, "righe": 7, "colonne": 7, "riempimento_at": 4, "vuoti_hash": 1}, "45": {"totale_pezzi": 46, "righe": 7, "colonne": 7, "riempimento_at": 3, "vuoti_hash": 1}, "46": {"totale_pezzi": 47, "righe": 7, "colonne": 7, "riempimento_at": 2, "vuoti_hash": 1}, "47": {"totale_pezzi": 48, "righe": 7, "colonne": 7, "riempimento_at": 1, "vuoti_hash": 1}, "48": {"totale_pezzi": 49, "righe": 7, "colonne": 7, "riempimento_at": 0, "vuoti_hash": 1}, "49": {"totale_pezzi": 50, "righe": 7, "colonne": 8, "riempimento_at": 6, "vuoti_hash": 1}, "50": {"totale_pezzi": 51, "righe": 7, "colonne": 8, "riempimento_at": 5, "vuoti_hash": 1}, "51": {"totale_pezzi": 52, "righe": 7, "colonne": 8, "riempimento_at": 4, "vuoti_hash": 1}, "52": {"totale_pezzi": 53, "righe": 7, "colonne": 8, "riempimento_at": 3, "vuoti_hash": 1}, "53": {"totale_pezzi": 54, "righe": 7, "colonne": 8, "riempimento_at": 2, "vuoti_hash": 1}, "54": {"totale_pezzi": 55, "righe": 7, "colonne": 8, "riempimento_at": 1, "vuoti_hash": 1}, "55": {"totale_pezzi": 56, "righe": 7, "colonne": 8, "riempimento_at": 0, "vuoti_hash": 1}, "56": {"totale_pezzi": 57, "righe": 8, "colonne": 8, "riempimento_at": 7, "vuoti_hash": 1}, "57": {"totale_pezzi": 58, "righe": 8, "colonne": 8, "riempimento_at": 6, "vuoti_hash": 1}, "58": {"totale_pezzi": 59, "righe": 8, "colonne": 8, "riempimento_at": 5, "vuoti_hash": 1}, "59": {"totale_pezzi": 60, "righe": 8, "colonne": 8, "riempimento_at": 4, "vuoti_hash": 1}, "60": {"totale_pezzi": 61, "righe": 8, "colonne": 8, "riempimento_at": 3, "vuoti_hash": 1}, "61": {"totale_pezzi": 62, "righe": 8, "colonne": 8, "riempimento_at": 2, "vuoti_hash": 1}, "62": {"totale_pezzi": 63, "righe": 8, "colonne": 8, "riempimento_at": 1, "vuoti_hash": 1}, "63": {"totale_pezzi": 64, "righe": 8, "colonne": 8, "riempimento_at": 0, "vuoti_hash": 1}, "64": {"totale_pezzi": 65, "righe": 8, "colonne": 9, "riempimento_at": 7, "vuoti_hash": 1}, "65": {"totale_pezzi": 66, "righe": 8, "colonne": 9, "riempimento_at": 6, "vuoti_hash": 1}, "66": {"totale_pezzi": 67, "righe": 8, "colonne": 9, "riempimento_at": 5, "vuoti_hash": 1}, "67": {"totale_pezzi": 68, "righe": 8, "colonne": 9, "riempimento_at": 4, "vuoti_hash": 1}, "68": {"totale_pezzi": 69, "righe": 8, "colonne": 9, "riempimento_at": 3, "vuoti_hash": 1}, "69": {"totale_pezzi": 70, "righe": 8, "colonne": 9, "riempimento_at": 2, "vuoti_hash": 1}, "70": {"totale_pezzi": 71, "righe": 8, "colonne": 9, "riempimento_at": 1, "vuoti_hash": 1}, "71": {"totale_pezzi": 72, "righe": 8, "colonne": 9, "riempimento_at": 0, "vuoti_hash": 1}, "72": {"totale_pezzi": 73, "righe": 9, "colonne": 9, "riempimento_at": 8, "vuoti_hash": 1}, "73": {"totale_pezzi": 74, "righe": 9, "colonne": 9, "riempimento_at": 7, "vuoti_hash": 1}, "74": {"totale_pezzi": 75, "righe": 9, "colonne": 9, "riempimento_at": 6, "vuoti_hash": 1}, "75": {"totale_pezzi": 76, "righe": 9, "colonne": 9, "riempimento_at": 5, "vuoti_hash": 1}, "76": {"totale_pezzi": 77, "righe": 9, "colonne": 9, "riempimento_at": 4, "vuoti_hash": 1}, "77": {"totale_pezzi": 78, "righe": 9, "colonne": 9, "riempimento_at": 3, "vuoti_hash": 1}, "78": {"totale_pezzi": 79, "righe": 9, "colonne": 9, "riempimento_at": 2, "vuoti_hash": 1}, "79": {"totale_pezzi": 80, "righe": 9, "colonne": 9, "riempimento_at": 1, "vuoti_hash": 1}, "80": {"totale_pezzi": 81, "righe": 9, "colonne": 9, "riempimento_at": 0, "vuoti_hash": 1}, "81": {"totale_pezzi": 82, "righe": 9, "colonne": 10, "riempimento_at": 8, "vuoti_hash": 1}, "82": {"totale_pezzi": 83, "righe": 9, "colonne": 10, "riempimento_at": 7, "vuoti_hash": 1}, "83": {"totale_pezzi": 84, "righe": 9, "colonne": 10, "riempimento_at": 6, "vuoti_hash": 1}, "84": {"totale_pezzi": 85, "righe": 9, "colonne": 10, "riempimento_at": 5, "vuoti_hash": 1}, "85": {"totale_pezzi": 86, "righe": 9, "colonne": 10, "riempimento_at": 4, "vuoti_hash": 1}, "86": {"totale_pezzi": 87, "righe": 9, "colonne": 10, "riempimento_at": 3, "vuoti_hash": 1}, "87": {"totale_pezzi": 88, "righe": 9, "colonne": 10, "riempimento_at": 2, "vuoti_hash": 1}, "88": {"totale_pezzi": 89, "righe": 9, "colonne": 10, "riempimento_at": 1, "vuoti_hash": 1}, "89": {"totale_pezzi": 90, "righe": 9, "colonne": 10, "riempimento_at": 0, "vuoti_hash": 1}, "90": {"totale_pezzi": 91, "righe": 10, "colonne": 10, "riempimento_at": 9, "vuoti_hash": 1}, "91": {"totale_pezzi": 92, "righe": 10, "colonne": 10, "riempimento_at": 8, "vuoti_hash": 1}, "92": {"totale_pezzi": 93, "righe": 10, "colonne": 10, "riempimento_at": 7, "vuoti_hash": 1}, "93": {"totale_pezzi": 94, "righe": 10, "colonne": 10, "riempimento_at": 6, "vuoti_hash": 1}, "94": {"totale_pezzi": 95, "righe": 10, "colonne": 10, "riempimento_at": 5, "vuoti_hash": 1}, "95": {"totale_pezzi": 96, "righe": 10, "colonne": 10, "riempimento_at": 4, "vuoti_hash": 1}, "96": {"totale_pezzi": 97, "righe": 10, "colonne": 10, "riempimento_at": 3, "vuoti_hash": 1}, "97": {"totale_pezzi": 98, "righe": 10, "colonne": 10, "riempimento_at": 2, "vuoti_hash": 1}, "98": {"totale_pezzi": 99, "righe": 10, "colonne": 10, "riempimento_at": 1, "vuoti_hash": 1}, "99": {"totale_pezzi": 100, "righe": 10, "colonne": 10, "riempimento_at": 0, "vuoti_hash": 1}, "100": {"totale_pezzi": 101, "righe": 10, "colonne": 11, "riempimento_at": 9, "vuoti_hash": 1}}}</script>
<script>
(() => {
  const data = JSON.parse(document.getElementById("puzzle-data").textContent);
  const paroleBase = data.parole.slice();
  const mappa = data.mappa;

  const board=document.querySelector(".board"),
        frame=document.querySelector(".board-wrap"),
        btnShuffle=document.querySelector("#shuffle"),
        btnSolve=document.querySelector("#solve"),
        btnNext=document.querySelector("#next"),
        btnFacile=document.querySelector("#btnFacile"),
        btnDifficile=document.querySelector("#btnDifficile"),
        btnTesto=document.querySelector("#btnTesto"),
        btnNumeri=document.querySelector("#btnNumeri"),
        btnScrivi=document.querySelector("#btnScrivi"),
        dialog=document.querySelector(".dialog-overlay"),
        input=document.querySelector("#frase"),
        okBtn=document.querySelector("#okBtn"),
        cancelBtn=document.querySelector("#cancelBtn");

  let mode='names',short=true,queue=[],qIndex=0,current=[],solution=[],conf=null,cols=0;

  // AUDIO
  let ctx=null;
  const ensure=()=>{if(!ctx)ctx=new (window.AudioContext||window.webkitAudioContext)();if(ctx.state==="suspended")ctx.resume();};
  const tick=()=>{ensure();const o=ctx.createOscillator(),g=ctx.createGain();o.type="square";o.frequency.value=240;g.gain.value=.06;o.connect(g);g.connect(ctx.destination);o.start();g.gain.exponentialRampToValueAtTime(.0001,ctx.currentTime+.08);o.stop(ctx.currentTime+.08);};
  const cheer=d=>{ensure();const s=ctx.currentTime,e=s+d;let t=s;while(t<e){const o=ctx.createOscillator(),g=ctx.createGain();o.type="sine";const f1=400+Math.random()*1e3,f2=f1+600;o.frequency.setValueAtTime(f1,t);o.frequency.exponentialRampToValueAtTime(f2,t+.25);g.gain.setValueAtTime(.05,t);g.gain.exponentialRampToValueAtTime(.0001,t+.3);o.connect(g);g.connect(ctx.destination);o.start(t);o.stop(t+.3);t+=.3;}};

  document.addEventListener("touchstart",()=>ensure(),{once:true,passive:true});
  document.addEventListener("click",()=>ensure(),{once:true,passive:true});

  const disp=c=>c===" "?"Â·":(c==="#"||c==="@"?"":c),
        coord=(i,c)=>[Math.floor(i/c),i%c],
        eq=(a,b)=>a.length===b.length&&a.every((x,i)=>x===b[i]),
        shuf=a=>{let r=a.slice();do{for(let i=r.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[r[i],r[j]]=[r[j],r[i]]}}while(eq(r,a));return r},
        nearest=n=>{const k=Object.keys(mappa).map(Number);let b=k[0];for(const x of k)if(Math.abs(x-n)<Math.abs(b-n))b=x;return mappa[b]};

  function buildText(t){
    const n=[...t].length;
    conf=mappa[n]||nearest(n);cols=conf.colonne;
    solution=[...t,...Array(conf.riempimento_at).fill("@"),...Array(conf.vuoti_hash).fill("#")];
    current=shuf(solution);render();
  }
  function buildNums(s){mode=s===4?"numbers4":"numbers3";const m=s*s-1,nums=Array.from({length:m},(_,i)=>(i+1).toString());solution=[...nums,"#"];current=shuf(solution);conf={colonne:s,righe:s,riempimento_at:0,vuoti_hash:1};cols=s;render();updateButtons();}
  function setNames(s){mode='names';short=s;const base=paroleBase.slice();const list=s?base.map(p=>{const i=p.indexOf(" ");return i>=0?p.slice(i+1).trim():p}):base;queue=list.slice();for(let i=queue.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[queue[i],queue[j]]=[queue[j],queue[i]]}qIndex=0;frame.classList.toggle("large-border",s);buildText(queue[qIndex]);updateButtons();}
  function setCustom(t){mode='custom';frame.classList.remove("large-border");buildText(t);updateButtons();}

  function render(){board.style.gridTemplateColumns=`repeat(${conf.colonne},1fr)`;board.innerHTML="";current.forEach((v,i)=>{const d=document.createElement("div");d.className="tile "+(v==="#"?"empty":v==="@"?"at":"letter")+" clickable";d.textContent=disp(v);d.addEventListener("click",()=>move(i),{passive:true});board.appendChild(d)})}
  function move(i){const e=current.indexOf("#");if(e<0||i===e)return;const[rE,cE]=coord(e,cols),[rI,cI]=coord(i,cols);if(rE===rI){const dir=cI<cE?1:-1;for(let c=cE-dir;c!==cI-dir;c-=dir){const a=rE*cols+c,b=rE*cols+c+dir;[current[a],current[b]]=[current[b],current[a]]}}else if(cE===cI){const dir=rI<rE?1:-1;for(let r=rE-dir;r!==rI-dir;r-=dir){const a=r*cols+cE,b=(r+dir)*cols+cE;[current[a],current[b]]=[current[b],current[a]]}}else return;tick();render();if(eq(current,solution)){cheer(4);frame.classList.add("flash-border");setTimeout(()=>frame.classList.remove("flash-border"),4e3)}}

  btnShuffle.onclick=()=>{current=shuf(solution);render();};
  btnSolve.onclick=()=>{current=solution.slice();render();};
  btnNext.onclick=()=>{if(mode==='numbers4'||mode==='numbers3'||mode==='custom'){current=shuf(solution);render();return;}qIndex++;if(qIndex>=queue.length){for(let i=queue.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[queue[i],queue[j]]=[queue[j],queue[i]]}qIndex=0}buildText(queue[qIndex]);};

  function updateButtons(){if(mode==='numbers4'){btnFacile.style.display='inline-block';btnDifficile.style.display='none';}else if(mode==='numbers3'){btnFacile.style.display='none';btnDifficile.style.display='inline-block';}else if(mode==='names'){if(short){btnFacile.style.display='none';btnDifficile.style.display='inline-block';}else{btnFacile.style.display='inline-block';btnDifficile.style.display='none';}}else{btnFacile.style.display='none';btnDifficile.style.display='none';}if(mode.startsWith('numbers')){btnTesto.style.display='inline-block';btnNumeri.style.display='none';}else{btnTesto.style.display='none';btnNumeri.style.display='inline-block';}}

  const onTap=(el,fn)=>{el.addEventListener('touchend',e=>{e.preventDefault();fn();},{passive:false});el.addEventListener('click',fn);};
  onTap(btnFacile,()=>{if(mode==='numbers4'){buildNums(3);}else if(mode==='names'&&!short){setNames(true);}});
  onTap(btnDifficile,()=>{if(mode==='numbers3'){buildNums(4);}else if(mode==='names'&&short){setNames(false);}});
  onTap(btnTesto,()=>{setNames(true);});
  onTap(btnNumeri,()=>{buildNums(4);});
  onTap(btnScrivi,()=>{input.value="";dialog.style.display="flex";input.focus();});
  input.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();okBtn.click();}});
  okBtn.onclick=()=>{const t=input.value.trim().toUpperCase();dialog.style.display="none";if(!t)return;setCustom(t);};
  cancelBtn.onclick=()=>{dialog.style.display="none";};
  setNames(true);
})();
</script>
</body>
</html>