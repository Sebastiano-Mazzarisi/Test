<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playing for Resilience</title>
    <meta name="apple-mobile-web-app-title" content="Playing for Resilience">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Sebastiano-Mazzarisi/Test/35f45f651fc8580ac4af1dd5111a55b57ba2444a/LogoPFR.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Sebastiano-Mazzarisi/Test/35f45f651fc8580ac4af1dd5111a55b57ba2444a/LogoPFR.png">
    
    <style>
        :root { 
            --primary-color: #004080; --secondary-color: #5a7d9a; 
            --success-color: #2e7d32; --danger-color: #c62828; --warning-color: #ff8f00; 
            --teal-color: #00695c; --light-gray: #f8f9fa; --gray: #e9ecef; 
            --font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            --pastel-green: #a5d6a7; --pastel-blue: #90caf9; --pastel-orange: #ffcc80;
        }
        body { font-family: var(--font-family); line-height: 1.6; margin: 0; background-color: var(--light-gray); color: #333; }
        .view { display: none; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 2.5rem; background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        header { border-bottom: 2px solid var(--primary-color); margin-bottom: 1.5rem; padding-bottom: 1rem; text-align: center;}
        .logo { max-width: 150px; height: auto; margin-bottom: 1rem; cursor: pointer; }
        h1, h2, h3, h4 { color: var(--primary-color); font-weight: 600; }
        .button { display: inline-block; padding: 12px 28px; background-color: var(--primary-color); color: white; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; text-align: center; margin-top: 1rem; font-size: 1em; font-weight: 500; transition: background-color 0.2s, box-shadow 0.2s; }
        .button:hover { background-color: #003366; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .text-center { text-align: center; }
        
        /* Game UI */
        #game-dashboard { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; background-color: var(--light-gray); padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border: 2px solid var(--pastel-blue); }
        .metric { text-align: center; }
        .metric .label { font-size: 0.8em; color: var(--secondary-color); text-transform: uppercase; }
        .metric .value { font-size: 1.6em; font-weight: 700; }
        #game-budget { color: var(--primary-color); }
        #game-resilience { color: var(--success-color); }
        #game-opinion { color: var(--warning-color); }
        #game-environment { color: var(--teal-color); }
        #news-panel { margin-bottom: 2rem; padding: 1rem; background-color: #fffbeb; border: 2px solid var(--pastel-orange); border-left-width: 5px; border-radius: 8px; }
        #choices-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
        .choice-card { border: 2px solid var(--gray); border-radius: 8px; padding: 1rem; text-align: center; transition: box-shadow 0.2s, border-color 0.2s; display: flex; flex-direction: column; }
        .card-constructive { border-color: var(--pastel-green); }
        .card-infrastructure { border-color: var(--pastel-blue); }
        .card-political { border-color: var(--pastel-orange); }
        .choice-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .choice-card h4 { margin-top: 0; font-size: 1.1em; }
        .choice-card .cost { font-size: 1.1em; font-weight: bold; color: var(--danger-color); margin-bottom: 1rem; }
        .choice-card ul { list-style-type: none; padding: 0; text-align: left; font-size: 0.9em; flex-grow: 1; }
        .impact-good { color: var(--success-color); }
        .impact-bad { color: var(--danger-color); }
        .choice-card .button { width: 100%; }
        .btn-constructive { background-color: var(--success-color); } .btn-constructive:hover { background-color: #256a29; }
        .btn-infrastructure { background-color: var(--secondary-color); } .btn-infrastructure:hover { background-color: #4a6781; }
        .btn-political { background-color: var(--warning-color); } .btn-political:hover { background-color: #d97800; }
        #event-log { margin-bottom: 2rem; padding: 1rem; background-color: #e3f2fd; border: 2px solid var(--secondary-color); border-radius: 8px; text-align: center; }
        .end-game-summary { padding: 2rem; background-color: var(--light-gray); border: 2px solid var(--primary-color); border-radius: 8px; }
        .final-metrics { display: flex; justify-content: space-around; gap: 1rem; margin: 1.5rem 0; text-align: center; flex-wrap: wrap; }
        .final-metric { flex-basis: 150px; }
        .final-metric .label { font-weight: 600; color: var(--secondary-color); }
        .final-metric .value { font-size: 1.8em; font-weight: 700; }
        .progress-bar-wrapper { height: 10px; background-color: var(--gray); border-radius: 5px; margin-top: 5px; overflow: hidden; }
        .progress-bar { height: 100%; border-radius: 5px; transition: width 0.5s ease-in-out; }
        .progress-resilience { background-color: var(--success-color); }
        .progress-opinion { background-color: var(--warning-color); }
        .progress-environment { background-color: var(--teal-color); }
        .final-feedback { text-align: center; font-size: 1.1em; margin: 1.5rem 0; }
        
        /* Report & Questionario */
        #report-content { display: flex; flex-direction: row; gap: 1.5rem; align-items: stretch; }
        .report-section { flex: 1; min-width: 200px; border: 2px solid var(--pastel-blue); border-radius: 8px; padding: 1.5rem; background-color: var(--light-gray); }
        .report-section h4 { margin-top: 0; }
        .report-section ul { padding-left: 20px; }
        .question-group { margin-bottom: 2rem; background-color: #fff; padding: 1.5rem 2rem; border-radius: 8px; border: 2px solid var(--pastel-blue); box-shadow: 0 2px 6px rgba(0,0,0,0.03); }
        .question-group h4 { margin-top: 0; }
        .choice-experiment { display: flex; gap: 1.5rem; justify-content: center; flex-direction: column; }
        @media (min-width: 768px) { .choice-experiment { flex-direction: row; } }
        .policy-option { flex: 1; border: 2px solid var(--gray); padding: 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; position: relative; background-color: var(--light-gray); }
        .policy-option:hover { border-color: var(--secondary-color); }
        .policy-option.selected { border-color: var(--pastel-green); background-color: #e8f5e9; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .policy-option.selected::after { content: '✔'; font-size: 1.5em; color: var(--success-color); position: absolute; top: 10px; right: 10px; }
        .policy-option ul { list-style-type: none; padding-left: 0; }
        .policy-option li { display: flex; align-items: center; margin-bottom: 0.5rem; }
        .policy-option .icon { font-size: 1.5em; margin-right: 10px; width: 25px; text-align: center; }
        .impact-positive { color: var(--success-color); }
        .impact-negative { color: var(--danger-color); }
        .perception-question { display: flex; align-items: center; gap: 1.5rem; }
        .perception-question .icon { font-size: 2.5em; }
        .perception-question .text { flex-grow: 1; }
        .likert-buttons { display: flex; justify-content: center; gap: 0.5rem; flex-wrap: wrap; margin-top: 1rem; }
        .likert-btn { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--gray); background-color: #fff; cursor: pointer; font-size: 1.2em; font-weight: bold; transition: all 0.2s; }
        .likert-btn:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .likert-btn.selected { border-width: 3px; transform: translateY(-3px) scale(1.1); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .likert-1 { color: #d32f2f; border-color: #d32f2f; } .likert-1.selected { background-color: #d32f2f; color: white; }
        .likert-2 { color: #ef5350; border-color: #ef5350; } .likert-2.selected { background-color: #ef5350; color: white; }
        .likert-3 { color: #ffab40; border-color: #ffab40; } .likert-3.selected { background-color: #ffab40; color: white; }
        .likert-4 { color: #66bb6a; border-color: #66bb6a; } .likert-4.selected { background-color: #66bb6a; color: white; }
        .likert-5 { color: #388e3c; border-color: #388e3c; } .likert-5.selected { background-color: #388e3c; color: white; }

        /* Stili per il mobile */
        @media (max-width: 992px) {
            #report-content { flex-direction: column; } 
        }
        @media (max-width: 768px) {
            body { font-size: 1.05em; }
            .container { padding: 1.5rem 1rem; margin: 1rem 0.5rem; }
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.3rem; }
            #game-dashboard { grid-template-columns: 1fr 1fr; }
            .metric .value { font-size: 1.2em; }
            #choices-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="view-start" class="view" style="display: block;">
        <div class="container">
            <header>
                <img src="https://raw.githubusercontent.com/Sebastiano-Mazzarisi/Test/35f45f651fc8580ac4af1dd5111a55b57ba2444a/LogoPFR.png" alt="Logo Playing for Resilience" class="logo" onclick="showView('view-methodology')">
                <h1>Progetto di Ricerca "Playing for Resilience"</h1>
            </header>
            <main>
                <p>Benvenuto/a. Stai per partecipare a uno studio che esplora nuovi modi di comunicare le sfide dell'adattamento climatico. La tua partecipazione è volontaria e anonima e contribuirà alla ricerca nel campo delle scienze sociali per la sostenibilità.</p>
                <p>Verrai assegnato/a casualmente a una di due condizioni sperimentali. Clicca sul logo per maggiori dettagli sulla metodologia.</p>
                <div class="text-center"> <button class="button" onclick="startExperiment()">Inizia l'Esperimento</button> </div>
            </main>
        </div>
    </div>

    <div id="view-methodology" class="view" style="display: none;">
        <div class="container">
            <header> <h2>Spiegazione del Disegno Sperimentale</h2> </header>
            <main>
                <h4>Perché non posso scegliere il percorso?</h4>
                <p>Il prototipo simula un'<strong>assegnazione casuale</strong> a una delle due condizioni (gioco o report), come previsto dal disegno sperimentale "between-subjects" del progetto di ricerca. Questo metodo è cruciale per la validità scientifica dei risultati.</p>
                <div class="text-center"> <button class="button" onclick="showView('view-start')">Torna alla Home</button> </div>
            </main>
        </div>
    </div>
    
    <div id="view-game" class="view" style="display: none;">
        <div class="container">
            <header> <h2>Sindaco di Costa Futura</h2> <p>Il tuo obiettivo è guidare la città per i prossimi 30 anni, gestendo il budget per proteggerla dagli impatti climatici.</p> </header>
            <div id="game-dashboard">
                <div class="metric"><div class="label">Anno</div><div class="value" id="game-year"></div></div>
                <div class="metric"><div class="label">Budget</div><div class="value" id="game-budget"></div></div>
                <div class="metric"><div class="label">Resilienza</div><div class="value" id="game-resilience"></div></div>
                <div class="metric"><div class="label">Op. Pubblica</div><div class="value" id="game-opinion"></div></div>
                <div class="metric"><div class="label">Ambiente</div><div class="value" id="game-environment"></div></div>
            </div>
            <div id="news-panel"></div>
            <div id="event-log" style="display:none;"></div>
            <h4>Decisioni di Mandato (scegli un'azione)</h4>
            <div id="choices-container"></div>
            <div class="text-center" id="pass-turn-container" style="display: none;">
                <button class="button" id="pass-turn-btn" onclick="passTurn()">Risparmia e passa al turno successivo</button>
            </div>
        </div>
    </div>
    
    <div id="view-report" class="view" style="display: none;">
        <div class="container">
            <header><h2>Documento Informativo: Strategie di Adattamento</h2></header>
            <p>Le seguenti opzioni sono disponibili per la pianificazione strategica trentennale della città di Costa Futura.</p>
            <div id="report-content"></div>
            <div class="text-center" style="margin-top: 2rem;"> <button class="button" onclick="showView('view-questionnaire')">Vai al Questionario Finale</button> </div>
        </div>
    </div>

    <div id="view-questionnaire" class="view" style="display: none;">
        <div class="container">
            <header><h3>Questionario Finale</h3></header>
            <form onsubmit="event.preventDefault(); handleQuestionnaireSubmit()">
                <div class="question-group">
                    <h4>Esperimento di Scelta</h4>
                    <p>Immagina di dover scegliere un piano di adattamento per i prossimi 30 anni. Quale preferiresti? Clicca per selezionare.</p>
                    <div class="choice-experiment">
                        <div class="policy-option" id="policy-a" onclick="selectPolicy('a')">
                            <h4>Piano Alfa</h4>
                            <ul>
                                <li><span class="icon">💰</span><strong>Costo:</strong> 50€/anno</li>
                                <li><span class="icon">🛡️</span><strong>Protezione:</strong> Alto</li>
                                <li class="impact-negative"><span class="icon">🌿</span><strong>Impatto Amb.:</strong> Negativo</li>
                            </ul>
                        </div>
                        <div class="policy-option" id="policy-b" onclick="selectPolicy('b')">
                            <h4>Piano Beta</h4>
                            <ul>
                                <li><span class="icon">💰</span><strong>Costo:</strong> 30€/anno</li>
                                <li><span class="icon">🛡️</span><strong>Protezione:</strong> Medio</li>
                                <li class="impact-positive"><span class="icon">🌿</span><strong>Impatto Amb.:</strong> Positivo</li>
                            </ul>
                        </div>
                    </div>
                    <input type="hidden" id="policy-choice-input" required>
                </div>
                <div class="question-group">
                    <div class="perception-question">
                        <span class="icon">💪</span>
                        <div class="text">
                            <h4>Percezioni Individuali</h4>
                            <label>"Mi sento in grado di contribuire a mitigare gli effetti del cambiamento climatico."</label>
                        </div>
                    </div>
                    <div class="likert-buttons" id="likert-efficacy" data-target-input="q-efficacy-input">
                        <button type="button" class="likert-btn likert-1" data-value="1" title="Per nulla d'accordo">1</button>
                        <button type="button" class="likert-btn likert-2" data-value="2" title="Poco d'accordo">2</button>
                        <button type="button" class="likert-btn likert-3" data-value="3" title="Neutrale">3</button>
                        <button type="button" class="likert-btn likert-4" data-value="4" title="D'accordo">4</button>
                        <button type="button" class="likert-btn likert-5" data-value="5" title="Pienamente d'accordo">5</button>
                    </div>
                    <input type="hidden" id="q-efficacy-input" required>
                </div>
                 <div class="question-group">
                    <div class="perception-question">
                        <span class="icon">⚠️</span>
                        <div class="text">
                             <h4>Percezione del Rischio</h4>
                            <label>Quanto percepisci alto il rischio di eventi climatici estremi nella tua regione?</label>
                        </div>
                    </div>
                     <div class="likert-buttons" id="likert-risk" data-target-input="q-risk-input">
                        <button type="button" class="likert-btn likert-1" data-value="1" title="Molto basso">1</button>
                        <button type="button" class="likert-btn likert-2" data-value="2" title="Basso">2</button>
                        <button type="button" class="likert-btn likert-3" data-value="3" title="Medio">3</button>
                        <button type="button" class="likert-btn likert-4" data-value="4" title="Alto">4</button>
                        <button type="button" class="likert-btn likert-5" data-value="5" title="Molto alto">5</button>
                    </div>
                    <input type="hidden" id="q-risk-input" required>
                </div>
                <div class="text-center"> <button type="submit" class="button">Invia Questionario</button> </div>
            </form>
        </div>
    </div>
    
    <div id="view-debriefing" class="view" style="display: none;">
        <div class="container">
            <header><h3>Riepilogo del tuo Mandato</h3></header>
            <p>Grazie per aver completato la simulazione. Ecco un riepilogo finale dello stato di Costa Futura al 2055.</p>
            <div id="debriefing-dashboard"></div>
            <div id="debriefing-analysis" class="report-section"></div>
            <div class="text-center"><button class="button" onclick="showView('view-start')">Torna alla Home</button></div>
        </div>
    </div>

    <script>
        // --- GAME & EXPERIMENT CONFIG ---
        let wasInGame = false;
        const INVESTMENTS = { diga: { name: "Costruzione Diga", category: "infrastructure", cost: 40, effects: { 'Resilienza': 30, 'Opinione Pubblica': -10, 'Salute Ambientale': -20 } }, ripascimento: { name: "Ripascimento Spiagge", category: "constructive", cost: 20, effects: { 'Resilienza': 15, 'Opinione Pubblica': 15, 'Salute Ambientale': 5 } }, delocalizzazione: { name: "Delocalizzazione", category: "political", cost: 50, effects: { 'Resilienza': 25, 'Opinione Pubblica': -20, 'Salute Ambientale': 10 } }, allerta: { name: "Sistema di Allerta", category: "constructive", cost: 10, effects: { 'Resilienza': 5, 'Opinione Pubblica': 10, 'Salute Ambientale': 0 } } };
        const DILEMMAS = { bonus: { name: "Bonus Elettorale", category: "political", cost: 10, effects: { 'Opinione Pubblica': 20, 'budget_next': -15 } }, manutenzione: { name: "Fondo Manutenzione", category: "infrastructure", cost: 10, effects: { 'Resilienza': 10, 'Opinione Pubblica': -5 } } };
        const SOCIAL_NORMS = [ "Un report nazionale indica che il 70% delle città costiere sta investendo in soluzioni basate sulla natura.", "Gli esperti raccomandano di dare priorità a investimenti con benefici a lungo termine.", "I sindaci rieletti hanno speso in media il 30% in più per la resilienza rispetto a quelli non rieletti." ];
        const EVENTS = [ { name: "una forte mareggiata", effects: { resilience: -20, opinion: -15 } }, { name: "un'ondata di calore", effects: { opinion: -10, environment: -10 } }, { name: "un boom del turismo ecologico", effects: { budget: 15, opinion: 10 } } ];
        let gameState = {};

        // --- CORE NAVIGATION & SETUP ---
        function showView(viewId) { document.querySelectorAll('.view').forEach(v => v.style.display = 'none'); document.getElementById(viewId).style.display = 'block'; }
        function startExperiment() { wasInGame = false; if (Math.random() > 0.5) { wasInGame = true; initializeGame(); showView('view-game'); } else { renderReport(); showView('view-report'); } }

        // --- GAME LOGIC ---
        function initializeGame() { gameState = { turn: 0, year: 2025, budget: 100, resilience: 20, opinion: 50, environment: 50 }; document.getElementById('event-log').style.display = 'none'; document.getElementById('pass-turn-container').style.display = 'block'; runTurn(); }
        function advanceTurnAndTriggerEvent() { const eventLog = document.getElementById('event-log'); if (Math.random() > 0.3 && gameState.turn > 0) { const randomEvent = EVENTS[Math.floor(Math.random() * EVENTS.length)]; eventLog.innerHTML = `<strong>Evento!</strong> Nel ${gameState.year+2}, ${randomEvent.name} ha colpito la città.`; for (const eff in randomEvent.effects) { gameState[eff] = Math.max(0, Math.min(100, gameState[eff] + randomEvent.effects[eff])); } eventLog.style.display = 'block'; } else { eventLog.style.display = 'none'; } gameState.turn++; gameState.year += 5; if (gameState.nextBudgetEffect) { gameState.budget += gameState.nextBudgetEffect; delete gameState.nextBudgetEffect; } runTurn(); }
        function passTurn() { const eventLog = document.getElementById('event-log'); eventLog.innerHTML = `Hai deciso di non fare investimenti per questo mandato, risparmiando il budget.`; eventLog.style.display = 'block'; advanceTurnAndTriggerEvent(); }
        function runTurn() { if (gameState.turn >= 6) { endGame(); return; } updateGameUI(); document.getElementById('news-panel').style.display = 'block'; document.getElementById('news-panel').innerHTML = `📰 <strong>Notiziario Comunale:</strong> ${SOCIAL_NORMS[Math.floor(Math.random() * SOCIAL_NORMS.length)]}`; const choicesContainer = document.getElementById('choices-container'); choicesContainer.innerHTML = ''; if (gameState.turn === 1 || gameState.turn === 3) { choicesContainer.innerHTML += createChoiceCard('bonus', DILEMMAS.bonus, true); choicesContainer.innerHTML += createChoiceCard('manutenzione', DILEMMAS.manutenzione, true); } else { for (const key in INVESTMENTS) { choicesContainer.innerHTML += createChoiceCard(key, INVESTMENTS[key]); } } choicesContainer.querySelectorAll('button').forEach(btn => btn.addEventListener('click', handleChoice)); }
        function createChoiceCard(key, item, isDilemma=false) { let effectsHTML = '<ul>'; for (const eff_raw in item.effects) { const value = item.effects[eff_raw]; const eff = eff_raw.replace('_next',''); let label = eff.charAt(0).toUpperCase() + eff.slice(1); let text = `${label}: ${value > 0 ? '+' : ''}${value}`; if(eff === 'budget') text = `Budget prox. turno: ${value > 0 ? '+' : ''}${value}M €`; const icon = value >= 0 ? '<span class="impact-good">▲</span>' : '<span class="impact-bad">▼</span>'; effectsHTML += `<li>${icon} ${text}</li>`; } effectsHTML += '</ul>'; const buttonClass = `btn-${item.category || 'infrastructure'}`; return `<div class="choice-card card-${item.category || 'infrastructure'}"><h4>${item.name}</h4><p class="cost">${item.cost}M €</p>${effectsHTML}<button class="button ${buttonClass}" data-key="${key}" data-is-dilemma="${isDilemma}">Approva</button></div>`; }
        function handleChoice(event) { const key = event.target.dataset.key; const isDilemma = event.target.dataset.isDilemma === 'true'; const choice = isDilemma ? DILEMMAS[key] : INVESTMENTS[key]; if (gameState.budget < choice.cost) { alert("Budget insufficiente!"); return; } gameState.budget -= choice.cost; for (const eff_raw in choice.effects) { const eff = eff_raw.replace('_next', ''); const value = choice.effects[eff_raw]; if (eff_raw.includes('_next')) { gameState.nextBudgetEffect = (gameState.nextBudgetEffect || 0) + value; } else { let keyToUpdate = eff.toLowerCase().replace(/ /g, ''); if (keyToUpdate === 'opinionepubblica') keyToUpdate = 'opinion'; else if (keyToUpdate === 'saluteambientale') keyToUpdate = 'environment'; gameState[keyToUpdate] = Math.max(0, Math.min(100, gameState[keyToUpdate] + value)); } } advanceTurnAndTriggerEvent(); }
        function updateGameUI() { document.getElementById('game-year').textContent = gameState.year; document.getElementById('game-budget').textContent = `${gameState.budget}M €`; document.getElementById('game-resilience').textContent = `${gameState.resilience}/100`; document.getElementById('game-opinion').textContent = `${gameState.opinion}/100`; document.getElementById('game-environment').textContent = `${gameState.environment}/100`; }
        function endGame() { const choicesContainer = document.getElementById('choices-container'); const finalState = gameState; let feedbackText = ''; if (finalState.resilience < 40) { feedbackText = `<p class='impact-bad'>La città è rimasta vulnerabile agli eventi climatici.</p>`; } else if (finalState.resilience > 70) { feedbackText = `<p class='impact-good'>Hai reso la città molto resiliente!</p>`; } else { feedbackText = `<p>Hai mantenuto un discreto livello di resilienza.</p>`; } let summaryHTML = `<div class="end-game-summary"><h4>Mandato Concluso: Riepilogo Finale (Anno ${finalState.year})</h4><div class="final-metrics"><div class="final-metric"><div class="label">Resilienza</div><div class="value" style="color:var(--success-color)">${finalState.resilience}/100</div><div class="progress-bar-wrapper"><div class="progress-bar progress-resilience" style="width: ${finalState.resilience}%;"></div></div></div><div class="final-metric"><div class="label">Opinione Pubblica</div><div class="value" style="color:var(--warning-color)">${finalState.opinion}/100</div><div class="progress-bar-wrapper"><div class="progress-bar progress-opinion" style="width: ${finalState.opinion}%;"></div></div></div><div class="final-metric"><div class="label">Salute Ambientale</div><div class="value" style="color:var(--teal-color)">${finalState.environment}/100</div><div class="progress-bar-wrapper"><div class="progress-bar progress-environment" style="width: ${finalState.environment}%;"></div></div></div></div><div class="final-feedback">${feedbackText}</div><div class="text-center"><button class="button" onclick="showView('view-questionnaire')">Prosegui al Questionario</button></div></div>`; choicesContainer.innerHTML = summaryHTML; document.getElementById('news-panel').style.display = 'none'; document.getElementById('event-log').style.display = 'none'; document.getElementById('pass-turn-container').style.display = 'none'; }
        
        // --- REPORT, QUESTIONNAIRE & DEBRIEFING LOGIC ---
        function renderReport() { const container = document.getElementById('report-content'); container.innerHTML = ''; for (const key in INVESTMENTS) { const inv = INVESTMENTS[key]; const section = document.createElement('div'); section.className = 'report-section'; let effectsHTML = '<ul>'; for (const eff in inv.effects) { effectsHTML += `<li><strong>Impatto su ${eff}:</strong> ${inv.effects[eff]} punti</li>`; } effectsHTML += '</ul>'; section.innerHTML = `<h4>${inv.name}</h4><p><strong>Costo:</strong> ${inv.cost}M €.</p><strong>Effetti:</strong>${effectsHTML}`; container.appendChild(section); } }
        function selectPolicy(choice) { document.getElementById('policy-a').classList.remove('selected'); document.getElementById('policy-b').classList.remove('selected'); document.getElementById(`policy-${choice}`).classList.add('selected'); document.getElementById('policy-choice-input').value = choice; }
        function handleLikertSelection(event) { const button = event.target.closest('.likert-btn'); if (!button) return; const value = button.dataset.value; const container = button.parentElement; const targetInputId = container.dataset.targetInput; const input = document.getElementById(targetInputId); if (input) { input.value = value; container.querySelectorAll('.likert-btn').forEach(btn => btn.classList.remove('selected')); button.classList.add('selected'); } }
        document.addEventListener('DOMContentLoaded', () => { document.getElementById('likert-efficacy').addEventListener('click', handleLikertSelection); document.getElementById('likert-risk').addEventListener('click', handleLikertSelection); });
        function handleQuestionnaireSubmit() { if (wasInGame) { renderDebriefing(); showView('view-debriefing'); } else { showView('view-start'); } }
        function renderDebriefing() { const dashboard = document.getElementById('debriefing-dashboard'); dashboard.innerHTML = `<div id="game-dashboard"> <div class="metric"><div class="label">Resilienza</div><div class="value">${gameState.resilience}/100</div></div> <div class="metric"><div class="label">Op. Pubblica</div><div class="value">${gameState.opinion}/100</div></div> <div class="metric"><div class="label">Ambiente</div><div class="value">${gameState.environment}/100</div></div> </div>`; const analysis = document.getElementById('debriefing-analysis'); let text = 'Le tue decisioni hanno portato la città a un buon equilibrio. '; if (gameState.resilience < 40) text = 'La città è vulnerabile!'; if (gameState.opinion < 40) text += 'L\'opinione pubblica è bassa. '; if (gameState.environment < 40) text += 'L\'ambiente ha sofferto.'; analysis.innerHTML = `<p>${text}</p><p>Questo gioco illustra i complessi <strong>trade-off</strong> che i decisori devono affrontare.</p>`; }
    </script>
</body>
</html>